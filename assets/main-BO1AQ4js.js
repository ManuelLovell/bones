import{O as r,C as t}from"./bsConstants-ro0LkXpK.js";r.onReady(async()=>{const h="/noscene.svg",L="/cancel-dice.svg",g="/go.svg",B=await r.player.getName(),N=await r.player.getId();await r.popover.open({id:t.EXTENSIONDICECONTROLLERID,url:"/dicecontroller.html",height:350,width:0,anchorOrigin:{horizontal:"RIGHT",vertical:"BOTTOM"},transformOrigin:{horizontal:"RIGHT",vertical:"BOTTOM"},disableClickAway:!0,marginThreshold:120});let E={};function p(n,u,C){const o=document.createElement("input");o.id=n,o.type="image",o.value="0",o.title=C,o.src=u,o.classList.add("dice-button"),o.onclick=v=>{let c=parseInt(a.innerText);v.stopPropagation(),v.preventDefault(),c===0&&(a.hidden=!1),c<20&&(c++,a.innerText=c.toString(),E[n]=c),Object.values(E).reduce((m,T)=>m+T,0)===0?(e.src=L,e.classList.remove("pulse")):(e.src=g,e.classList.add("pulse"))},o.oncontextmenu=v=>{let c=parseInt(a.innerText);v.stopPropagation(),v.preventDefault(),c>0&&(c--,a.innerText=c.toString(),E[n]=c),c===0&&(a.hidden=!0),Object.values(E).reduce((m,T)=>m+T,0)===0?(e.src=L,e.classList.remove("pulse")):(e.src=g,e.classList.add("pulse"))};const l=document.createElement("div");l.id=n+"Container",l.classList.add("label-container");const a=document.createElement("label");return a.innerText="0",a.id=n+"Label",a.classList.add("label"),a.classList.add("dice-counter"),a.hidden=!0,l.appendChild(o),l.appendChild(a),l}const O=document.createElement("div");O.classList.add("options-container");const i=document.createElement("input");i.id="rollSelfButton",i.type="button",i.classList.add("options-button"),i.value="Self",i.dataset.active=t.FALSE,i.onclick=()=>{i.dataset.active===t.TRUE?(i.dataset.active=t.FALSE,i.classList.remove("options-active")):(i.dataset.active=t.TRUE,i.classList.add("options-active"))};const s=document.createElement("input");s.id="rollGMButton",s.type="button",s.classList.add("options-button"),s.value="GM",s.onclick=()=>{s.dataset.active===t.TRUE?(s.dataset.active=t.FALSE,s.classList.remove("options-active")):(s.dataset.active=t.TRUE,s.classList.add("options-active"))};const d=document.createElement("input");d.id="showLogButton",d.type="button",d.classList.add("options-button"),d.value="Log",d.dataset.active=t.CLOSE,d.onclick=async()=>{d.dataset.active===t.OPEN?(d.dataset.active=t.CLOSE,await r.popover.setWidth(t.EXTENSIONDICECONTROLLERID,0),d.classList.remove("options-active")):(d.dataset.active=t.OPEN,await r.popover.setWidth(t.EXTENSIONDICECONTROLLERID,220),d.classList.add("options-active"))},O.appendChild(d),O.appendChild(s),O.appendChild(i);const I=p("d4Button","/dice-four.svg","Add a Four-Sided Dice"),D=p("d6Button","/dice-six.svg","Add a Six-Sided Dice"),f=p("d8Button","/dice-eight.svg","Add a Eight-Sided Dice"),w=p("d10Button","/dice-ten.svg","Add a Ten-Sided Dice"),b=p("d12Button","/dice-twelve.svg","Add a Twelve-Sided Dice"),y=p("d20Button","/dice-twenty.svg","Add a Twenty-Sided Dice"),A=p("d100Button","/dice-hundred.svg","Add a Percentile and Ten-Sided Dice"),R=await r.scene.isReady(),e=document.createElement("input");e.id="diceWindowOpen",e.type="image",e.src=R?L:h,e.disabled=!R,e.classList.add("dice-button"),e.onclick=async()=>{const n=[];for(const[u,C]of Object.entries(E)){const o=u.replace("Button","");n.push(`${C}${o}`)}if(n.length!==0){const u=n.join("+"),C=i.dataset.active,o=s.dataset.active;let l="ALL";C==="TRUE"&&(l="SELF"),o==="TRUE"&&(l="GM");const a={},v=new Date().toISOString();a[`${t.EXTENSIONID}/metadata_bonesroll`]={notation:u,created:v,senderName:B,senderId:N,viewers:l},await r.player.setMetadata(a),S()}},e.oncontextmenu=async n=>{n.stopPropagation(),n.preventDefault(),S()},t.BONESDICECONTROLLER.appendChild(O),t.BONESDICECONTROLLER.appendChild(I),t.BONESDICECONTROLLER.appendChild(D),t.BONESDICECONTROLLER.appendChild(f),t.BONESDICECONTROLLER.appendChild(w),t.BONESDICECONTROLLER.appendChild(A),t.BONESDICECONTROLLER.appendChild(b),t.BONESDICECONTROLLER.appendChild(y),t.BONESCONTROLLER.appendChild(e);function S(){E={};const n=document.querySelectorAll(".dice-counter");e.src=L,e.classList.remove("pulse"),s.dataset.active=t.FALSE,s.classList.remove("options-active"),s.classList.remove("options-hover"),i.dataset.active=t.FALSE,i.classList.remove("options-active"),i.classList.remove("options-hover"),n.forEach(u=>{u.hidden=!0,u.innerText="0"})}r.scene.onReadyChange(n=>{e.disabled=!n,e.src=n?L:h,e.classList.remove("pulse")})});
