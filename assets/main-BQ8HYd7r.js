import{O as E,C as e}from"./bsConstants-O-uRKwz7.js";const X={d4:"/dice-four.svg",d6:"/dice-six.svg",d8:"/dice-eight.svg",d10:"/dice-ten.svg",d12:"/dice-twelve.svg",d20:"/dice-twenty.svg",d100:"/dice-hundred.svg"},j={d4:"Add a Four-Sided Dice",d6:"Add a Six-Sided Dice",d8:"Add an Eight-Sided Dice",d10:"Add a Ten-Sided Dice",d12:"Add a Twelve-Sided Dice",d20:"Add a Twenty-Sided Dice",d100:"Add a Hundred-Sided Dice"},H={d4:"/gen-boost.svg",d6:"/gen-setback.svg",d8:"/gen-ability.svg",d10:"/gen-difficulty.svg",d12:"/gen-challenge.svg",d20:"/blank.svg",d100:"/gen-proficiency.svg"},W={d4:"Add a Boost die",d6:"Add a Setback die",d8:"Add an Ability die",d10:"Add a Difficulty die",d12:"Add a Challenge die",d20:"",d100:"Add a Proficiency die"};E.onReady(async()=>{const I="/noscene.svg",O="/cancel-dice.svg",S="/go.svg",D=await E.player.getName(),y=await E.player.getId();let T=(await E.room.getMetadata())[e.DICETEXTURESETTING+y]??"default";function N(){return T==="genesys"?{imageMappings:H,textMappings:W}:{imageMappings:X,textMappings:j}}function l(t){const{imageMappings:d}=N();return d[t]||"default-image.svg"}function r(t){const{textMappings:d}=N();return d[t]||"Unknown Dice Type"}E.room.onMetadataChange(t=>{const d=t[e.DICETEXTURESETTING+y]??"default";if(T==="genesys"&&d!=="genesys"||T!=="genesys"&&d==="genesys"){let u=function(g,s,v){const o=document.getElementById(g);o.src=s,o.title=v};T=d,u("d4Button",l("d4"),r("d4")),u("d6Button",l("d6"),r("d6")),u("d8Button",l("d8"),r("d8")),u("d10Button",l("d10"),r("d10")),u("d12Button",l("d12"),r("d12")),u("d20Button",l("d20"),r("d20")),u("d100Button",l("d100"),r("d100"));const a=document.getElementById("d20Button");a.disabled=d==="genesys",h()}}),await E.popover.open({id:e.EXTENSIONDICECONTROLLERID,url:"/dicecontroller.html",height:350,width:0,anchorOrigin:{horizontal:"RIGHT",vertical:"BOTTOM"},transformOrigin:{horizontal:"RIGHT",vertical:"BOTTOM"},disableClickAway:!0,marginThreshold:120});let C={};function m(t,d,u){const a=document.createElement("input");a.id=t,a.type="image",a.value="0",a.title=u,a.src=d,T==="genesys"&&t==="d20Button"&&(a.disabled=!0),a.classList.add("dice-button"),a.onclick=v=>{let o=parseInt(s.innerText);v.stopPropagation(),v.preventDefault(),o===0&&(s.hidden=!1),o<20&&(o++,s.innerText=o.toString(),C[t]=o),Object.values(C).reduce((B,L)=>B+L,0)===0?(n.src=O,n.classList.remove("pulse")):(n.src=S,n.classList.add("pulse"))},a.oncontextmenu=v=>{let o=parseInt(s.innerText);v.stopPropagation(),v.preventDefault(),o>0&&(o--,s.innerText=o.toString(),C[t]=o),o===0&&(s.hidden=!0),Object.values(C).reduce((B,L)=>B+L,0)===0?(n.src=O,n.classList.remove("pulse")):(n.src=S,n.classList.add("pulse"))};const g=document.createElement("div");g.id=t+"Container",g.classList.add("label-container");const s=document.createElement("label");return s.innerText="0",s.id=t+"Label",s.classList.add("label"),s.classList.add("dice-counter"),s.hidden=!0,g.appendChild(a),g.appendChild(s),g}const f=document.createElement("div");f.classList.add("options-container");const i=document.createElement("input");i.id="rollSelfButton",i.type="button",i.classList.add("options-button"),i.value="Self",i.dataset.active=e.FALSE,i.onclick=()=>{i.dataset.active===e.TRUE?(i.dataset.active=e.FALSE,i.classList.remove("options-active")):(i.dataset.active=e.TRUE,i.classList.add("options-active"))};const c=document.createElement("input");c.id="rollGMButton",c.type="button",c.classList.add("options-button"),c.value="GM",c.onclick=()=>{c.dataset.active===e.TRUE?(c.dataset.active=e.FALSE,c.classList.remove("options-active")):(c.dataset.active=e.TRUE,c.classList.add("options-active"))};const p=document.createElement("input");p.id="showLogButton",p.type="button",p.classList.add("options-button"),p.value="Log",p.dataset.active=e.CLOSE,p.onclick=async()=>{p.dataset.active===e.OPEN?(p.dataset.active=e.CLOSE,await E.popover.setWidth(e.EXTENSIONDICECONTROLLERID,0),p.classList.remove("options-active")):(p.dataset.active=e.OPEN,await E.popover.setWidth(e.EXTENSIONDICECONTROLLERID,220),p.classList.add("options-active"))},f.appendChild(p),f.appendChild(c),f.appendChild(i);const w=m("d4Button",l("d4"),r("d4")),A=m("d6Button",l("d6"),r("d6")),M=m("d8Button",l("d8"),r("d8")),x=m("d10Button",l("d10"),r("d10")),k=m("d12Button",l("d12"),r("d12")),G=m("d20Button",l("d20"),r("d20")),U=m("d100Button",l("d100"),r("d100")),b=await E.scene.isReady(),n=document.createElement("input");n.id="diceWindowOpen",n.type="image",n.src=b?O:I,n.disabled=!b,n.classList.add("dice-button"),n.onclick=async()=>{const t=[];for(const[d,u]of Object.entries(C)){const a=d.replace("Button","");t.push(`${u}${a}`)}if(t.length!==0){let d=t.join("+");if(T==="genesys"){let o=function(B){let L=B;for(const[F,P]of R)L=L.replace(new RegExp(F,"g"),P);return L};const R=new Map([["d100","proficiency"],["d12","challenge"],["d10","difficulty"],["d8","ability"],["d6","setback"],["d4","boost"]]);d=o(d)}const u=i.dataset.active,a=c.dataset.active;let g="ALL";u==="TRUE"&&(g="SELF"),a==="TRUE"&&(g="GM");const s={},v=new Date().toISOString();s[`${e.EXTENSIONID}/metadata_bonesroll`]={notation:d,created:v,senderName:D,senderId:y,viewers:g},await E.player.setMetadata(s),h()}},n.oncontextmenu=async t=>{t.stopPropagation(),t.preventDefault(),h()},e.BONESDICECONTROLLER.appendChild(f),e.BONESDICECONTROLLER.appendChild(w),e.BONESDICECONTROLLER.appendChild(A),e.BONESDICECONTROLLER.appendChild(M),e.BONESDICECONTROLLER.appendChild(x),e.BONESDICECONTROLLER.appendChild(U),e.BONESDICECONTROLLER.appendChild(k),e.BONESDICECONTROLLER.appendChild(G),e.BONESDICECONTROLLER.appendChild(n);function h(){C={};const t=document.querySelectorAll(".dice-counter");n.src=O,n.classList.remove("pulse"),c.dataset.active=e.FALSE,c.classList.remove("options-active"),c.classList.remove("options-hover"),i.dataset.active=e.FALSE,i.classList.remove("options-active"),i.classList.remove("options-hover"),t.forEach(d=>{d.hidden=!0,d.innerText="0"})}E.scene.onReadyChange(t=>{n.disabled=!t,n.src=t?O:I,n.classList.remove("pulse")})});
