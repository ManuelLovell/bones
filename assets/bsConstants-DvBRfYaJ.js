(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const r of i.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=e(o);fetch(o.href,i)}})();var g=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class ae{constructor(t){this.messageBus=t}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return g(this,void 0,void 0,function*(){const{selection:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return t})}select(t,e){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:t,replace:e})})}deselect(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:t})})}getName(){return g(this,void 0,void 0,function*(){const{name:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return t})}setName(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:t})})}getColor(){return g(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return t})}setColor(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:t})})}getSyncView(){return g(this,void 0,void 0,function*(){const{syncView:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return t})}setSyncView(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:t})})}getId(){return g(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return t})}getRole(){return g(this,void 0,void 0,function*(){const{role:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return t})}getMetadata(){return g(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return t})}setMetadata(t){return g(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:t})})}hasPermission(t){return g(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:s}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return s.indexOf(t)>-1})}getConnectionId(){return g(this,void 0,void 0,function*(){const{connectionId:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return t})}onChange(t){const e=s=>{t(s.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",e)}}}var L=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class ce{constructor(t){this.messageBus=t}reset(){return L(this,void 0,void 0,function*(){const{transform:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return t})}animateTo(t){return L(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:t})})}animateToBounds(t){return L(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:t})})}getPosition(){return L(this,void 0,void 0,function*(){const{position:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return t})}setPosition(t){return L(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:t})})}getScale(){return L(this,void 0,void 0,function*(){const{scale:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return t})}setScale(t){return L(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:t})})}getWidth(){return L(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return t})}getHeight(){return L(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return t})}transformPoint(t){return L(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:t});return e})}inverseTransformPoint(t){return L(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:t});return e})}}function fe(n){return typeof n.id=="string"}var Tt={exports:{}},W=typeof Reflect=="object"?Reflect:null,bt=W&&typeof W.apply=="function"?W.apply:function(t,e,s){return Function.prototype.apply.call(t,e,s)},tt;W&&typeof W.ownKeys=="function"?tt=W.ownKeys:Object.getOwnPropertySymbols?tt=function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:tt=function(t){return Object.getOwnPropertyNames(t)};function he(n){console&&console.warn&&console.warn(n)}var Zt=Number.isNaN||function(t){return t!==t};function E(){E.init.call(this)}Tt.exports=E;Tt.exports.once=ye;E.EventEmitter=E;E.prototype._events=void 0;E.prototype._eventsCount=0;E.prototype._maxListeners=void 0;var wt=10;function ot(n){if(typeof n!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n)}Object.defineProperty(E,"defaultMaxListeners",{enumerable:!0,get:function(){return wt},set:function(n){if(typeof n!="number"||n<0||Zt(n))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+n+".");wt=n}});E.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};E.prototype.setMaxListeners=function(t){if(typeof t!="number"||t<0||Zt(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this};function Jt(n){return n._maxListeners===void 0?E.defaultMaxListeners:n._maxListeners}E.prototype.getMaxListeners=function(){return Jt(this)};E.prototype.emit=function(t){for(var e=[],s=1;s<arguments.length;s++)e.push(arguments[s]);var o=t==="error",i=this._events;if(i!==void 0)o=o&&i.error===void 0;else if(!o)return!1;if(o){var r;if(e.length>0&&(r=e[0]),r instanceof Error)throw r;var f=new Error("Unhandled error."+(r?" ("+r.message+")":""));throw f.context=r,f}var h=i[t];if(h===void 0)return!1;if(typeof h=="function")bt(h,this,e);else for(var d=h.length,u=te(h,d),s=0;s<d;++s)bt(u[s],this,e);return!0};function Qt(n,t,e,s){var o,i,r;if(ot(e),i=n._events,i===void 0?(i=n._events=Object.create(null),n._eventsCount=0):(i.newListener!==void 0&&(n.emit("newListener",t,e.listener?e.listener:e),i=n._events),r=i[t]),r===void 0)r=i[t]=e,++n._eventsCount;else if(typeof r=="function"?r=i[t]=s?[e,r]:[r,e]:s?r.unshift(e):r.push(e),o=Jt(n),o>0&&r.length>o&&!r.warned){r.warned=!0;var f=new Error("Possible EventEmitter memory leak detected. "+r.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");f.name="MaxListenersExceededWarning",f.emitter=n,f.type=t,f.count=r.length,he(f)}return n}E.prototype.addListener=function(t,e){return Qt(this,t,e,!1)};E.prototype.on=E.prototype.addListener;E.prototype.prependListener=function(t,e){return Qt(this,t,e,!0)};function le(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function qt(n,t,e){var s={fired:!1,wrapFn:void 0,target:n,type:t,listener:e},o=le.bind(s);return o.listener=e,s.wrapFn=o,o}E.prototype.once=function(t,e){return ot(e),this.on(t,qt(this,t,e)),this};E.prototype.prependOnceListener=function(t,e){return ot(e),this.prependListener(t,qt(this,t,e)),this};E.prototype.removeListener=function(t,e){var s,o,i,r,f;if(ot(e),o=this._events,o===void 0)return this;if(s=o[t],s===void 0)return this;if(s===e||s.listener===e)--this._eventsCount===0?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,s.listener||e));else if(typeof s!="function"){for(i=-1,r=s.length-1;r>=0;r--)if(s[r]===e||s[r].listener===e){f=s[r].listener,i=r;break}if(i<0)return this;i===0?s.shift():_e(s,i),s.length===1&&(o[t]=s[0]),o.removeListener!==void 0&&this.emit("removeListener",t,f||e)}return this};E.prototype.off=E.prototype.removeListener;E.prototype.removeAllListeners=function(t){var e,s,o;if(s=this._events,s===void 0)return this;if(s.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):s[t]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete s[t]),this;if(arguments.length===0){var i=Object.keys(s),r;for(o=0;o<i.length;++o)r=i[o],r!=="removeListener"&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=s[t],typeof e=="function")this.removeListener(t,e);else if(e!==void 0)for(o=e.length-1;o>=0;o--)this.removeListener(t,e[o]);return this};function Yt(n,t,e){var s=n._events;if(s===void 0)return[];var o=s[t];return o===void 0?[]:typeof o=="function"?e?[o.listener||o]:[o]:e?Ee(o):te(o,o.length)}E.prototype.listeners=function(t){return Yt(this,t,!0)};E.prototype.rawListeners=function(t){return Yt(this,t,!1)};E.listenerCount=function(n,t){return typeof n.listenerCount=="function"?n.listenerCount(t):Xt.call(n,t)};E.prototype.listenerCount=Xt;function Xt(n){var t=this._events;if(t!==void 0){var e=t[n];if(typeof e=="function")return 1;if(e!==void 0)return e.length}return 0}E.prototype.eventNames=function(){return this._eventsCount>0?tt(this._events):[]};function te(n,t){for(var e=new Array(t),s=0;s<t;++s)e[s]=n[s];return e}function _e(n,t){for(;t+1<n.length;t++)n[t]=n[t+1];n.pop()}function Ee(n){for(var t=new Array(n.length),e=0;e<t.length;++e)t[e]=n[e].listener||n[e];return t}function ye(n,t){return new Promise(function(e,s){function o(r){n.removeListener(t,i),s(r)}function i(){typeof n.removeListener=="function"&&n.removeListener("error",o),e([].slice.call(arguments))}ee(n,t,i,{once:!0}),t!=="error"&&Oe(n,o,{once:!0})})}function Oe(n,t,e){typeof n.on=="function"&&ee(n,"error",t,e)}function ee(n,t,e,s){if(typeof n.on=="function")s.once?n.once(t,e):n.on(t,e);else if(typeof n.addEventListener=="function")n.addEventListener(t,function o(i){s.once&&n.removeEventListener(t,o),e(i)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof n)}var pe=Tt.exports;let Q;const me=new Uint8Array(16);function Te(){if(!Q&&(Q=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Q))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Q(me)}const m=[];for(let n=0;n<256;++n)m.push((n+256).toString(16).slice(1));function ge(n,t=0){return m[n[t+0]]+m[n[t+1]]+m[n[t+2]]+m[n[t+3]]+"-"+m[n[t+4]]+m[n[t+5]]+"-"+m[n[t+6]]+m[n[t+7]]+"-"+m[n[t+8]]+m[n[t+9]]+"-"+m[n[t+10]]+m[n[t+11]]+m[n[t+12]]+m[n[t+13]]+m[n[t+14]]+m[n[t+15]]}const ve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Dt={randomUUID:ve};function ne(n,t,e){if(Dt.randomUUID&&!t&&!n)return Dt.randomUUID();n=n||{};const s=n.random||(n.rng||Te)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,ge(s)}class Ae extends pe.EventEmitter{constructor(t,e){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=s=>{const o=s.data;if(s.origin===this.targetOrigin&&fe(o)){if(o.id==="OBR_READY"){this.ready=!0;const i=o.data;this.ref=i.ref,this.userId=i.userId}this.emit(o.id,o.data)}},this.send=(s,o,i)=>{var r;if(!this.ref)throw Error("Unable to send message: not ready");(r=window.parent)===null||r===void 0||r.postMessage({id:s,data:o,ref:this.ref,nonce:i},this.targetOrigin)},this.sendAsync=(s,o,i=5e3)=>{const r=`_${ne()}`;return this.send(s,o,r),Promise.race([new Promise((f,h)=>{const d=this;function u(_){d.off(`${s}_RESPONSE${r}`,u),d.off(`${s}_ERROR${r}`,c),f(_)}function c(_){d.off(`${s}_RESPONSE${r}`,u),d.off(`${s}_ERROR${r}`,c),h(_)}this.on(`${s}_RESPONSE${r}`,u),this.on(`${s}_ERROR${r}`,c)}),...i>0?[new Promise((f,h)=>window.setTimeout(()=>h(new Error(`Message ${s} took longer than ${i}ms to get a result`)),i))]:[]])},this.roomId=e,this.targetOrigin=t,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var Pt=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class Re{constructor(t){this.messageBus=t}show(t,e){return Pt(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:t,variant:e});return s})}close(t){return Pt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:t})})}}var U=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class Be{constructor(t){this.messageBus=t}getColor(){return U(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return t})}setColor(t){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:t})})}getStrokeWidth(){return U(this,void 0,void 0,function*(){const{strokeWidth:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return t})}setStrokeWidth(t){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:t})})}getFilled(){return U(this,void 0,void 0,function*(){const{filled:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return t})}setFilled(t){return U(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:t})})}onChange(t){const e=s=>{t(s.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",e)}}}var v=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class Ie{constructor(t){this.messageBus=t}getDpi(){return v(this,void 0,void 0,function*(){const{dpi:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return t})}getScale(){return v(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:t})})}getColor(){return v(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return t})}setColor(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:t})})}getOpacity(){return v(this,void 0,void 0,function*(){const{opacity:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return t})}setOpacity(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:t})})}getType(){return v(this,void 0,void 0,function*(){const{type:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return t})}setType(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:t})})}getLineType(){return v(this,void 0,void 0,function*(){const{lineType:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return t})}setLineType(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:t})})}getMeasurement(){return v(this,void 0,void 0,function*(){const{measurement:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return t})}setMeasurement(t){return v(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:t})})}snapPosition(t,e,s,o){return v(this,void 0,void 0,function*(){const{position:i}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:t,snappingSensitivity:e,useCorners:s,useCenter:o});return i})}getDistance(t,e){return v(this,void 0,void 0,function*(){const{distance:s}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:t,to:e});return s})}onChange(t){const e=s=>{t(s.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",e)}}}var q=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class Ne{constructor(t){this.messageBus=t}undo(){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return q(this,void 0,void 0,function*(){const{canUndo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return t})}canRedo(){return q(this,void 0,void 0,function*(){const{canRedo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return t})}}function T(n){for(var t=arguments.length,e=Array(t>1?t-1:0),s=1;s<t;s++)e[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+n+(e.length?" "+e.map(function(o){return"'"+o+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function P(n){return!!n&&!!n[N]}function M(n){var t;return!!n&&(function(e){if(!e||typeof e!="object")return!1;var s=Object.getPrototypeOf(e);if(s===null)return!0;var o=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===De}(n)||Array.isArray(n)||!!n[K]||!!(!((t=n.constructor)===null||t===void 0)&&t[K])||rt(n)||ut(n))}function F(n,t,e){e===void 0&&(e=!1),b(n)===0?(e?Object.keys:Nt)(n).forEach(function(s){e&&typeof s=="symbol"||t(s,n[s],n)}):n.forEach(function(s,o){return t(o,s,n)})}function b(n){var t=n[N];return t?t.i>3?t.i-4:t.i:Array.isArray(n)?1:rt(n)?2:ut(n)?3:0}function Z(n,t){return b(n)===2?n.has(t):Object.prototype.hasOwnProperty.call(n,t)}function et(n,t){return b(n)===2?n.get(t):n[t]}function ie(n,t,e){var s=b(n);s===2?n.set(t,e):s===3?n.add(e):n[t]=e}function Ce(n,t){return n===t?n!==0||1/n==1/t:n!=n&&t!=t}function rt(n){return be&&n instanceof Map}function ut(n){return we&&n instanceof Set}function w(n){return n.o||n.t}function gt(n){if(Array.isArray(n))return Array.prototype.slice.call(n);var t=Pe(n);delete t[N];for(var e=Nt(t),s=0;s<e.length;s++){var o=e[s],i=t[o];i.writable===!1&&(i.writable=!0,i.configurable=!0),(i.get||i.set)&&(t[o]={configurable:!0,writable:!0,enumerable:i.enumerable,value:n[o]})}return Object.create(Object.getPrototypeOf(n),t)}function vt(n,t){return t===void 0&&(t=!1),At(n)||P(n)||!M(n)||(b(n)>1&&(n.set=n.add=n.clear=n.delete=Le),Object.freeze(n),t&&F(n,function(e,s){return vt(s,!0)},!0)),n}function Le(){T(2)}function At(n){return n==null||typeof n!="object"||Object.isFrozen(n)}function x(n){var t=Ot[n];return t||T(18,n),t}function Se(n,t){Ot[n]||(Ot[n]=t)}function Gt(){return J}function dt(n,t){t&&(x("Patches"),n.u=[],n.s=[],n.v=t)}function nt(n){_t(n),n.p.forEach(xe),n.p=null}function _t(n){n===J&&(J=n.l)}function Ut(n){return J={p:[],l:J,h:n,m:!0,_:0}}function xe(n){var t=n[N];t.i===0||t.i===1?t.j():t.g=!0}function at(n,t){t._=t.p.length;var e=t.p[0],s=n!==void 0&&n!==e;return t.h.O||x("ES5").S(t,n,s),s?(e[N].P&&(nt(t),T(4)),M(n)&&(n=it(t,n),t.l||st(t,n)),t.u&&x("Patches").M(e[N].t,n,t.u,t.s)):n=it(t,e,[]),nt(t),t.u&&t.v(t.u,t.s),n!==It?n:void 0}function it(n,t,e){if(At(t))return t;var s=t[N];if(!s)return F(t,function(f,h){return Vt(n,s,t,f,h,e)},!0),t;if(s.A!==n)return t;if(!s.P)return st(n,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var o=s.i===4||s.i===5?s.o=gt(s.k):s.o,i=o,r=!1;s.i===3&&(i=new Set(o),o.clear(),r=!0),F(i,function(f,h){return Vt(n,s,o,f,h,e,r)}),st(n,o,!1),e&&n.u&&x("Patches").N(s,e,n.u,n.s)}return s.o}function Vt(n,t,e,s,o,i,r){if(P(o)){var f=it(n,o,i&&t&&t.i!==3&&!Z(t.R,s)?i.concat(s):void 0);if(ie(e,s,f),!P(f))return;n.m=!1}else r&&e.add(o);if(M(o)&&!At(o)){if(!n.h.D&&n._<1)return;it(n,o),t&&t.A.l||st(n,o)}}function st(n,t,e){e===void 0&&(e=!1),!n.l&&n.h.D&&n.m&&vt(t,e)}function ct(n,t){var e=n[N];return(e?w(e):n)[t]}function kt(n,t){if(t in n)for(var e=Object.getPrototypeOf(n);e;){var s=Object.getOwnPropertyDescriptor(e,t);if(s)return s;e=Object.getPrototypeOf(e)}}function Et(n){n.P||(n.P=!0,n.l&&Et(n.l))}function ft(n){n.o||(n.o=gt(n.t))}function yt(n,t,e){var s=rt(t)?x("MapSet").F(t,e):ut(t)?x("MapSet").T(t,e):n.O?function(o,i){var r=Array.isArray(o),f={i:r?1:0,A:i?i.A:Gt(),P:!1,I:!1,R:{},l:i,t:o,k:null,o:null,j:null,C:!1},h=f,d=pt;r&&(h=[f],d=$);var u=Proxy.revocable(h,d),c=u.revoke,_=u.proxy;return f.k=_,f.j=c,_}(t,e):x("ES5").J(t,e);return(e?e.A:Gt()).p.push(s),s}function Me(n){return P(n)||T(22,n),function t(e){if(!M(e))return e;var s,o=e[N],i=b(e);if(o){if(!o.P&&(o.i<4||!x("ES5").K(o)))return o.t;o.I=!0,s=Ht(e,i),o.I=!1}else s=Ht(e,i);return F(s,function(r,f){o&&et(o.t,r)===f||ie(s,r,t(f))}),i===3?new Set(s):s}(n)}function Ht(n,t){switch(t){case 2:return new Map(n);case 3:return Array.from(n)}return gt(n)}function Rt(){function n(s){if(!M(s))return s;if(Array.isArray(s))return s.map(n);if(rt(s))return new Map(Array.from(s.entries()).map(function(r){return[r[0],n(r[1])]}));if(ut(s))return new Set(Array.from(s).map(n));var o=Object.create(Object.getPrototypeOf(s));for(var i in s)o[i]=n(s[i]);return Z(s,K)&&(o[K]=s[K]),o}function t(s){return P(s)?n(s):s}var e="add";Se("Patches",{$:function(s,o){return o.forEach(function(i){for(var r=i.path,f=i.op,h=s,d=0;d<r.length-1;d++){var u=b(h),c=r[d];typeof c!="string"&&typeof c!="number"&&(c=""+c),u!==0&&u!==1||c!=="__proto__"&&c!=="constructor"||T(24),typeof h=="function"&&c==="prototype"&&T(24),typeof(h=et(h,c))!="object"&&T(15,r.join("/"))}var _=b(h),l=n(i.value),y=r[r.length-1];switch(f){case"replace":switch(_){case 2:return h.set(y,l);case 3:T(16);default:return h[y]=l}case e:switch(_){case 1:return y==="-"?h.push(l):h.splice(y,0,l);case 2:return h.set(y,l);case 3:return h.add(l);default:return h[y]=l}case"remove":switch(_){case 1:return h.splice(y,1);case 2:return h.delete(y);case 3:return h.delete(i.value);default:return delete h[y]}default:T(17,f)}}),s},N:function(s,o,i,r){switch(s.i){case 0:case 4:case 2:return function(f,h,d,u){var c=f.t,_=f.o;F(f.R,function(l,y){var O=et(c,l),R=et(_,l),B=y?Z(c,l)?"replace":e:"remove";if(O!==R||B!=="replace"){var I=h.concat(l);d.push(B==="remove"?{op:B,path:I}:{op:B,path:I,value:R}),u.push(B===e?{op:"remove",path:I}:B==="remove"?{op:e,path:I,value:t(O)}:{op:"replace",path:I,value:t(O)})}})}(s,o,i,r);case 5:case 1:return function(f,h,d,u){var c=f.t,_=f.R,l=f.o;if(l.length<c.length){var y=[l,c];c=y[0],l=y[1];var O=[u,d];d=O[0],u=O[1]}for(var R=0;R<c.length;R++)if(_[R]&&l[R]!==c[R]){var B=h.concat([R]);d.push({op:"replace",path:B,value:t(l[R])}),u.push({op:"replace",path:B,value:t(c[R])})}for(var I=c.length;I<l.length;I++){var G=h.concat([I]);d.push({op:e,path:G,value:t(l[I])})}c.length<l.length&&u.push({op:"replace",path:h.concat(["length"]),value:c.length})}(s,o,i,r);case 3:return function(f,h,d,u){var c=f.t,_=f.o,l=0;c.forEach(function(y){if(!_.has(y)){var O=h.concat([l]);d.push({op:"remove",path:O,value:y}),u.unshift({op:e,path:O,value:y})}l++}),l=0,_.forEach(function(y){if(!c.has(y)){var O=h.concat([l]);d.push({op:e,path:O,value:y}),u.unshift({op:"remove",path:O,value:y})}l++})}(s,o,i,r)}},M:function(s,o,i,r){i.push({op:"replace",path:[],value:o===It?void 0:o}),r.push({op:"replace",path:[],value:s})}})}var jt,J,Bt=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",be=typeof Map<"u",we=typeof Set<"u",Wt=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",It=Bt?Symbol.for("immer-nothing"):((jt={})["immer-nothing"]=!0,jt),K=Bt?Symbol.for("immer-draftable"):"__$immer_draftable",N=Bt?Symbol.for("immer-state"):"__$immer_state",De=""+Object.prototype.constructor,Nt=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(n){return Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n))}:Object.getOwnPropertyNames,Pe=Object.getOwnPropertyDescriptors||function(n){var t={};return Nt(n).forEach(function(e){t[e]=Object.getOwnPropertyDescriptor(n,e)}),t},Ot={},pt={get:function(n,t){if(t===N)return n;var e=w(n);if(!Z(e,t))return function(o,i,r){var f,h=kt(i,r);return h?"value"in h?h.value:(f=h.get)===null||f===void 0?void 0:f.call(o.k):void 0}(n,e,t);var s=e[t];return n.I||!M(s)?s:s===ct(n.t,t)?(ft(n),n.o[t]=yt(n.A.h,s,n)):s},has:function(n,t){return t in w(n)},ownKeys:function(n){return Reflect.ownKeys(w(n))},set:function(n,t,e){var s=kt(w(n),t);if(s?.set)return s.set.call(n.k,e),!0;if(!n.P){var o=ct(w(n),t),i=o?.[N];if(i&&i.t===e)return n.o[t]=e,n.R[t]=!1,!0;if(Ce(e,o)&&(e!==void 0||Z(n.t,t)))return!0;ft(n),Et(n)}return n.o[t]===e&&(e!==void 0||t in n.o)||Number.isNaN(e)&&Number.isNaN(n.o[t])||(n.o[t]=e,n.R[t]=!0),!0},deleteProperty:function(n,t){return ct(n.t,t)!==void 0||t in n.t?(n.R[t]=!1,ft(n),Et(n)):delete n.R[t],n.o&&delete n.o[t],!0},getOwnPropertyDescriptor:function(n,t){var e=w(n),s=Reflect.getOwnPropertyDescriptor(e,t);return s&&{writable:!0,configurable:n.i!==1||t!=="length",enumerable:s.enumerable,value:e[t]}},defineProperty:function(){T(11)},getPrototypeOf:function(n){return Object.getPrototypeOf(n.t)},setPrototypeOf:function(){T(12)}},$={};F(pt,function(n,t){$[n]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),$.deleteProperty=function(n,t){return $.set.call(this,n,t,void 0)},$.set=function(n,t,e){return pt.set.call(this,n[0],t,e,n[0])};var Ge=function(){function n(e){var s=this;this.O=Wt,this.D=!0,this.produce=function(o,i,r){if(typeof o=="function"&&typeof i!="function"){var f=i;i=o;var h=s;return function(O){var R=this;O===void 0&&(O=f);for(var B=arguments.length,I=Array(B>1?B-1:0),G=1;G<B;G++)I[G-1]=arguments[G];return h.produce(O,function(de){var Mt;return(Mt=i).call.apply(Mt,[R,de].concat(I))})}}var d;if(typeof i!="function"&&T(6),r!==void 0&&typeof r!="function"&&T(7),M(o)){var u=Ut(s),c=yt(s,o,void 0),_=!0;try{d=i(c),_=!1}finally{_?nt(u):_t(u)}return typeof Promise<"u"&&d instanceof Promise?d.then(function(O){return dt(u,r),at(O,u)},function(O){throw nt(u),O}):(dt(u,r),at(d,u))}if(!o||typeof o!="object"){if((d=i(o))===void 0&&(d=o),d===It&&(d=void 0),s.D&&vt(d,!0),r){var l=[],y=[];x("Patches").M(o,d,l,y),r(l,y)}return d}T(21,o)},this.produceWithPatches=function(o,i){if(typeof o=="function")return function(d){for(var u=arguments.length,c=Array(u>1?u-1:0),_=1;_<u;_++)c[_-1]=arguments[_];return s.produceWithPatches(d,function(l){return o.apply(void 0,[l].concat(c))})};var r,f,h=s.produce(o,i,function(d,u){r=d,f=u});return typeof Promise<"u"&&h instanceof Promise?h.then(function(d){return[d,r,f]}):[h,r,f]},typeof e?.useProxies=="boolean"&&this.setUseProxies(e.useProxies),typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=n.prototype;return t.createDraft=function(e){M(e)||T(8),P(e)&&(e=Me(e));var s=Ut(this),o=yt(this,e,void 0);return o[N].C=!0,_t(s),o},t.finishDraft=function(e,s){var o=e&&e[N],i=o.A;return dt(i,s),at(void 0,i)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!Wt&&T(20),this.O=e},t.applyPatches=function(e,s){var o;for(o=s.length-1;o>=0;o--){var i=s[o];if(i.path.length===0&&i.op==="replace"){e=i.value;break}}o>-1&&(s=s.slice(o+1));var r=x("Patches").$;return P(e)?r(e,s):this.produce(e,function(f){return r(f,s)})},n}(),C=new Ge;C.produce;var Ct=C.produceWithPatches.bind(C);C.setAutoFreeze.bind(C);C.setUseProxies.bind(C);C.applyPatches.bind(C);C.createDraft.bind(C);C.finishDraft.bind(C);var V=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};Rt();class Ue{constructor(t){this.messageBus=t}getItems(t){return V(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e,s=!0){return V(this,void 0,void 0,function*(){let o;this.isItemArray(t)?o=t:o=yield this.getItems(t);const[i,r]=Ct(o,e),f=i.map(d=>({id:d.id,type:d.type}));for(const d of r){const[u,c]=d.path;typeof u=="number"&&typeof c=="string"&&(f[u][c]=i[u][c])}const h=f.filter(d=>Object.keys(d).length>2);h.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:h,updateAttachments:s}))})}addItems(t){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:t})})}deleteItems(t){return V(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return V(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return V(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=s=>{t(s.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",e)}}}var k=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};Rt();class Ve{constructor(t){this.messageBus=t}getItems(t){return k(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e,s,o=!0){return k(this,void 0,void 0,function*(){let i;this.isItemArray(t)?i=t:i=yield this.getItems(t);const[r,f]=Ct(i,e),h=r.map(u=>({id:u.id,type:u.type}));for(const u of f){const[c,_]=u.path;typeof c=="number"&&typeof _=="string"&&(h[c][_]=r[c][_])}const d=h.filter(u=>Object.keys(u).length>2);d.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:d,fastUpdate:s,updateAttachments:o}))})}addItems(t){return k(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:t})})}deleteItems(t){return k(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return k(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return k(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=s=>{t(s.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",e)}}}var ht=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class ke{constructor(t){this.messageBus=t,this.grid=new Ie(t),this.fog=new Be(t),this.history=new Ne(t),this.items=new Ue(t),this.local=new Ve(t)}isReady(){return ht(this,void 0,void 0,function*(){const{ready:t}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return t})}onReadyChange(t){const e=s=>{t(s.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",e)}}getMetadata(){return ht(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return t})}setMetadata(t){return ht(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:t})})}onMetadataChange(t){const e=s=>{t(s.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",e)}}}function se(n){return n.startsWith("http")?n:`${window.location.origin}${n}`}function z(n){return n.map(t=>Object.assign(Object.assign({},t),{icon:se(t.icon)}))}function Lt(n){return Object.assign(Object.assign({},n),{url:se(n.url)})}var Ft=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class He{constructor(t){this.contextMenus={},this.handleClick=e=>{var s;const o=this.contextMenus[e.id];o&&((s=o.onClick)===null||s===void 0||s.call(o,e.context,e.elementId))},this.messageBus=t,t.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(t){return Ft(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:t.id,shortcut:t.shortcut,icons:z(t.icons),embed:t.embed&&Lt(t.embed)}),this.contextMenus[t.id]=t})}remove(t){return Ft(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:t}),delete this.contextMenus[t]})}}var S=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class je{constructor(t){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=e=>{const s=this.tools[e.id];if(s)if(s.onClick){const o=s.onClick(e.context,e.elementId);Promise.resolve(o).then(i=>{i&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})},this.handleToolActionClick=e=>{var s;const o=this.toolActions[e.id];o&&((s=o.onClick)===null||s===void 0||s.call(o,e.context,e.elementId))},this.handleToolModeClick=e=>{const s=this.toolModes[e.id];if(s)if(s.onClick){const o=s.onClick(e.context,e.elementId);Promise.resolve(o).then(i=>{i&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})},this.handleToolModeToolClick=e=>{const s=this.toolModes[e.id];if(s)if(s.onToolClick){const o=s.onToolClick(e.context,e.event);Promise.resolve(o).then(i=>{i&&e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDoubleClick=e=>{const s=this.toolModes[e.id];if(s)if(s.onToolDoubleClick){const o=s.onToolDoubleClick(e.context,e.event);Promise.resolve(o).then(i=>{i&&e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDown=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDown)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolMove=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolMove)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolUp=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolUp)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragStart=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragStart)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragMove=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragMove)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragEnd=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragEnd)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragCancel=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragCancel)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeKeyDown=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onKeyDown)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeKeyUp=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onKeyUp)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeActivate=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onActivate)===null||s===void 0||s.call(o,e.context))},this.handleToolModeDeactivate=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onDeactivate)===null||s===void 0||s.call(o,e.context))},this.messageBus=t,t.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),t.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),t.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),t.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),t.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),t.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),t.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),t.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:t.id,shortcut:t.shortcut,defaultMode:t.defaultMode,defaultMetadata:t.defaultMetadata,icons:z(t.icons),disabled:t.disabled}),this.tools[t.id]=t})}remove(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:t}),delete this.tools[t]})}activateTool(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:t})})}getMetadata(t){return S(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:t});return e})}setMetadata(t,e){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:t,update:e})})}createAction(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:t.id,shortcut:t.shortcut,icons:z(t.icons),disabled:t.disabled}),this.toolActions[t.id]=t})}removeAction(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:t}),delete this.tools[t]})}createMode(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:t.id,shortcut:t.shortcut,icons:z(t.icons),preventDrag:t.preventDrag,disabled:t.disabled,cursors:t.cursors}),this.toolModes[t.id]=t})}removeMode(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:t}),delete this.tools[t]})}activateMode(t,e){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:t,modeId:e})})}}var H=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class We{constructor(t){this.messageBus=t}open(t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},Lt(t)))})}close(t){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:t})})}getWidth(t){return H(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:t});return e})}setWidth(t,e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:t,width:e})})}getHeight(t){return H(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:t});return e})}setHeight(t,e){return H(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:t,height:e})})}}var $t=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class Fe{constructor(t){this.messageBus=t}open(t){return $t(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},Lt(t)))})}close(t){return $t(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:t})})}}var A=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class $e{constructor(t){this.messageBus=t}getWidth(){return A(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return t})}setWidth(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:t})})}getHeight(){return A(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return t})}setHeight(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:t})})}getBadgeText(){return A(this,void 0,void 0,function*(){const{badgeText:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return t})}setBadgeText(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:t})})}getBadgeBackgroundColor(){return A(this,void 0,void 0,function*(){const{badgeBackgroundColor:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return t})}setBadgeBackgroundColor(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:t})})}getIcon(){return A(this,void 0,void 0,function*(){const{icon:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return t})}setIcon(t){return A(this,void 0,void 0,function*(){const e=z([{icon:t}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:e[0].icon})})}getTitle(){return A(this,void 0,void 0,function*(){const{title:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return t})}setTitle(t){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:t})})}isOpen(){return A(this,void 0,void 0,function*(){const{isOpen:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return t})}open(){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return A(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(t){const e=s=>{t(s.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e)}}}var Ke=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};Rt();class ze{constructor(t){this.messageBus=t}startItemInteraction(t,e=!0){return Ke(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:t,updateAttachments:e});let o=t;return[f=>{const[h,d]=Ct(o,f);return o=h,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:s,patches:d}),h},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:s})}]})}}var Ze=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class Je{constructor(t){this.messageBus=t}getPlayers(){return Ze(this,void 0,void 0,function*(){const{players:t}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return t})}onChange(t){const e=s=>{t(s.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",e)}}}var lt=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class Qe{constructor(t){this.messageBus=t}get id(){return this.messageBus.roomId}getPermissions(){return lt(this,void 0,void 0,function*(){const{permissions:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return t})}getMetadata(){return lt(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return t})}setMetadata(t){return lt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:t})})}onMetadataChange(t){const e=s=>{t(s.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",e)}}onPermissionsChange(t){const e=s=>{t(s.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e)}}}var qe=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class Ye{constructor(t){this.messageBus=t}getTheme(){return qe(this,void 0,void 0,function*(){const{theme:t}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return t})}onChange(t){const e=s=>{t(s.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",e)}}}var Y=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class Xe{constructor(t){this.messageBus=t}uploadImages(t,e){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:t,typeHint:e})})}uploadScenes(t,e){return Y(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:t,disableShowScenes:e})})}downloadImages(t,e,s){return Y(this,void 0,void 0,function*(){const{images:o}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:t,defaultSearch:e,typeHint:s},-1);return o})}downloadScenes(t,e){return Y(this,void 0,void 0,function*(){const{scenes:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:t,defaultSearch:e},-1);return s})}}var tn=function(n,t,e,s){function o(i){return i instanceof e?i:new e(function(r){r(i)})}return new(e||(e=Promise))(function(i,r){function f(u){try{d(s.next(u))}catch(c){r(c)}}function h(u){try{d(s.throw(u))}catch(c){r(c)}}function d(u){u.done?i(u.value):o(u.value).then(f,h)}d((s=s.apply(n,t||[])).next())})};class en{constructor(t){this.messageBus=t}sendMessage(t,e,s){return tn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:t,data:e,options:s})})}onMessage(t,e){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:t}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${t}`,e),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:t}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${t}`,e)}}}class oe{constructor(t){this._item={createdUserId:t.id,id:ne(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:t.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(t){return this._item.createdUserId=t,this.self()}id(t){return this._item.id=t,this.self()}name(t){return this._item.name=t,this.self()}description(t){return this._item.description=t,this.self()}lastModified(t){return this._item.lastModified=t,this.self()}zIndex(t){return this._item.zIndex=t,this.self()}lastModifiedUserId(t){return this._item.lastModifiedUserId=t,this.self()}locked(t){return this._item.locked=t,this.self()}metadata(t){return this._item.metadata=t,this.self()}position(t){return this._item.position=t,this.self()}rotation(t){return this._item.rotation=t,this.self()}scale(t){return this._item.scale=t,this.self()}visible(t){return this._item.visible=t,this.self()}attachedTo(t){return this._item.attachedTo=t,this.self()}layer(t){return this._item.layer=t,this.self()}disableHit(t){return this._item.disableHit=t,this.self()}disableAutoZIndex(t){return this._item.disableAutoZIndex=t,this.self()}disableAttachmentBehavior(t){return this._item.disableAttachmentBehavior=t,this.self()}self(){return this}}class nn extends oe{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}richText(t){return this._text.richText=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}textType(t){return this._text.type=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}}class sn extends oe{constructor(t){super(t),this._commands=[],this._fillRule="nonzero",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.name="Path",this._item.layer="DRAWING"}commands(t){return this._commands=t,this.self()}fillRule(t){return this._fillRule=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"PATH",commands:this._commands,fillRule:this._fillRule,style:this._style})}}const St=typeof Buffer=="function",Kt=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const on="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",rn=Array.prototype.slice.call(on),X=(n=>{let t={};return n.forEach((e,s)=>t[e]=s),t})(rn),un=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,D=String.fromCharCode.bind(String),zt=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):n=>new Uint8Array(Array.prototype.slice.call(n,0)),re=n=>n.replace(/[^A-Za-z0-9\+\/]/g,""),dn=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,an=n=>{switch(n.length){case 4:var t=(7&n.charCodeAt(0))<<18|(63&n.charCodeAt(1))<<12|(63&n.charCodeAt(2))<<6|63&n.charCodeAt(3),e=t-65536;return D((e>>>10)+55296)+D((e&1023)+56320);case 3:return D((15&n.charCodeAt(0))<<12|(63&n.charCodeAt(1))<<6|63&n.charCodeAt(2));default:return D((31&n.charCodeAt(0))<<6|63&n.charCodeAt(1))}},cn=n=>n.replace(dn,an),fn=n=>{if(n=n.replace(/\s+/g,""),!un.test(n))throw new TypeError("malformed base64.");n+="==".slice(2-(n.length&3));let t,e="",s,o;for(let i=0;i<n.length;)t=X[n.charAt(i++)]<<18|X[n.charAt(i++)]<<12|(s=X[n.charAt(i++)])<<6|(o=X[n.charAt(i++)]),e+=s===64?D(t>>16&255):o===64?D(t>>16&255,t>>8&255):D(t>>16&255,t>>8&255,t&255);return e},ue=typeof atob=="function"?n=>atob(re(n)):St?n=>Buffer.from(n,"base64").toString("binary"):fn,hn=St?n=>zt(Buffer.from(n,"base64")):n=>zt(ue(n).split("").map(t=>t.charCodeAt(0))),ln=St?n=>Buffer.from(n,"base64").toString("utf8"):Kt?n=>Kt.decode(hn(n)):n=>cn(ue(n)),_n=n=>re(n.replace(/[-_]/g,t=>t=="-"?"+":"/")),En=n=>ln(_n(n));function yn(){const t=new URLSearchParams(window.location.search).get("obrref");let e="",s="";if(t){const i=En(t).split(" ");i.length===2&&(e=i[0],s=i[1])}return{origin:e,roomId:s}}var a;(function(n){n[n.MOVE=0]="MOVE",n[n.LINE=1]="LINE",n[n.QUAD=2]="QUAD",n[n.CONIC=3]="CONIC",n[n.CUBIC=4]="CUBIC",n[n.CLOSE=5]="CLOSE"})(a||(a={}));const mt=yn(),p=new Ae(mt.origin,mt.roomId),On=new ce(p),xt=new ae(p),pn=new Je(p),mn=new Re(p),Tn=new ke(p),gn=new He(p),vn=new je(p),An=new We(p),Rn=new Fe(p),Bn=new $e(p),In=new ze(p),Nn=new Qe(p),Cn=new Ye(p),Ln=new Xe(p),Sn=new en(p),xn={onReady:n=>{p.ready?n():p.once("OBR_READY",()=>n())},get isReady(){return p.ready},viewport:On,player:xt,party:pn,notification:mn,scene:Tn,contextMenu:gn,tool:vn,popover:An,modal:Rn,action:Bn,interaction:In,room:Nn,theme:Cn,assets:Ln,broadcast:Sn,isAvailable:!!mt.origin};function Mn(){return new nn(xt)}function bn(){return new sn(xt)}class j{static VERSION="whatsnew-bones-134";static EXTENSIONID="com.battle-system.bones";static EXTENSIONDICEWINDOWID="com.battle-system.bones-dicewindow";static EXTENSIONDICECONTROLLERID="com.battle-system.bones-dicecontroller";static EXTENSIONNOTIFY="com.battle-system.bones-notify";static DISCORDID="com.battle-system.discord";static DICETOKENBROADCAST="bones.dicetoken.broadcast";static OPEN="OPEN";static CLOSE="CLOSE";static TRUE="TRUE";static FALSE="FALSE";static DICEZOOMSETTING=`${j.EXTENSIONID}/zoom_`;static DICEMARKERSETTING=`${j.EXTENSIONID}/marker_`;static DICECOLORSETTING=`${j.EXTENSIONID}/color_`;static FRONTDICECOLORSETTING=`${j.EXTENSIONID}/fcolor_`;static DICETEXTURESETTING=`${j.EXTENSIONID}/texture_`;static NORMALDICE=/^[0-9+d]+$/;static DICENOTATION=/(\d+)[dD](\d+)(.*)$/i;static DICEMODIFIER=/([+-])(\d+)/;static PARENTHESESMATCH=/\((\d*d\d+\s*([+-]\s*\d+)?)\)/g;static PLUSMATCH=/\s?(\+\d+)\s?/g;static ALPHANUMERICTEXTMATCH=/\s[\da-zA-Z]$/;static BONESENTRY=document.querySelector("#bones-main-body-app");static BONESWINDOW=document.querySelector("#bones-window-body-app");static BONESDICECONTROLLER=document.querySelector("#bones-controller-dice");static BONESNOTIFICATIONS=document.querySelector("#bones-notify-body-app");static CHECKREGISTRATION="https://vrwtdtmnbyhaehtitrlb.supabase.co/functions/v1/patreon-check";static ANONAUTH="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";static DEFAULTTEXTURES=["default","diceOfRolling","gemstone","gemstoneMarble","rock","rust","smooth","wooden","genesys"]}class wn{static DiceRimPath(t,e,s){const o=s/2;return[[a.MOVE,t,e-o],[a.QUAD,t-o,e-o,t-o,e],[a.QUAD,t-o,e+o,t,e+o],[a.QUAD,t+o,e+o,t+o,e],[a.QUAD,t+o,e-o,t,e-o]]}static D4Path(t,e,s){const o=s/2*.8,i={top:{x:t,y:e-o},bottomRight:{x:t+o,y:e+o*.25},bottomLeft:{x:t-o,y:e+o*.25},bottom:{x:t,y:e+o}};return[[a.MOVE,i.top.x,i.top.y],[a.LINE,i.bottomLeft.x,i.bottomLeft.y],[a.LINE,i.bottom.x,i.bottom.y],[a.LINE,i.top.x,i.top.y],[a.LINE,i.bottomRight.x,i.bottomRight.y],[a.LINE,i.bottom.x,i.bottom.y]]}static D6Path(t,e,s){const o=s/2*.8,i={top:{x:t,y:e-o},bottom:{x:t,y:e+o},topRight:{x:t+o*.866,y:e-o*.5},bottomRight:{x:t+o*.866,y:e+o*.5},topLeft:{x:t-o*.866,y:e-o*.5},bottomLeft:{x:t-o*.866,y:e+o*.5}};return[[a.MOVE,i.top.x,i.top.y],[a.LINE,i.topRight.x,i.topRight.y],[a.LINE,i.bottomRight.x,i.bottomRight.y],[a.LINE,i.bottom.x,i.bottom.y],[a.LINE,t,e],[a.LINE,i.topRight.x,i.topRight.y],[a.MOVE,t,e],[a.LINE,i.topLeft.x,i.topLeft.y],[a.LINE,i.bottomLeft.x,i.bottomLeft.y],[a.LINE,i.bottom.x,i.bottom.y],[a.MOVE,i.top.x,i.top.y],[a.LINE,i.topLeft.x,i.topLeft.y]]}static D8Path(t,e,s){const o=s/2*.8,i={top:{x:t,y:e-o},left:{x:t-o,y:e},right:{x:t+o,y:e},bottom:{x:t,y:e+o}};return[[a.MOVE,i.top.x,i.top.y],[a.LINE,i.left.x,i.left.y],[a.LINE,t,e+o*.4],[a.LINE,i.top.x,i.top.y],[a.LINE,i.right.x,i.right.y],[a.LINE,t,e+o*.4],[a.LINE,i.bottom.x,i.bottom.y],[a.LINE,i.left.x,i.left.y],[a.MOVE,i.bottom.x,i.bottom.y],[a.LINE,i.right.x,i.right.y]]}static D100Path(t,e,s){const o=s/2*.8,i={top:{x:t,y:e-o},left:{x:t-o,y:e+o*.1},leftCrink:{x:t-o*.5,y:e},right:{x:t+o,y:e+o*.1},rightCrink:{x:t+o*.5,y:e},bottom:{x:t,y:e+o},center:{x:t,y:e+o*.2}},r={top:{x:t,y:e-o},left:{x:t-o,y:e-o*.1},leftCrink:{x:t-o*.5,y:e+o*.2},right:{x:t+o,y:e-o*.1},rightCrink:{x:t+o*.5,y:e+o*.2},bottom:{x:t,y:e+o},center:{x:t,y:e-o*.2}};return[[a.MOVE,i.top.x,i.top.y],[a.LINE,i.left.x,i.left.y],[a.LINE,i.leftCrink.x,i.leftCrink.y],[a.LINE,i.top.x,i.top.y],[a.LINE,i.rightCrink.x,i.rightCrink.y],[a.LINE,i.right.x,i.right.y],[a.LINE,i.top.x,i.top.y],[a.MOVE,i.bottom.x,i.bottom.y],[a.LINE,i.left.x,i.left.y],[a.LINE,i.leftCrink.x,i.leftCrink.y],[a.LINE,i.center.x,i.center.y],[a.LINE,i.bottom.x,i.bottom.y],[a.LINE,i.right.x,i.right.y],[a.LINE,i.rightCrink.x,i.rightCrink.y],[a.LINE,i.center.x,i.center.y],[a.MOVE,r.top.x,r.top.y],[a.LINE,r.left.x,r.left.y],[a.LINE,r.leftCrink.x,r.leftCrink.y],[a.LINE,r.top.x,r.top.y],[a.LINE,r.rightCrink.x,r.rightCrink.y],[a.LINE,r.right.x,r.right.y],[a.LINE,r.top.x,r.top.y],[a.MOVE,r.bottom.x,r.bottom.y],[a.LINE,r.left.x,r.left.y],[a.LINE,r.leftCrink.x,r.leftCrink.y],[a.LINE,r.center.x,r.center.y],[a.LINE,r.bottom.x,r.bottom.y],[a.LINE,r.right.x,r.right.y],[a.LINE,r.rightCrink.x,r.rightCrink.y],[a.LINE,r.center.x,r.center.y]]}static D10Path(t,e,s){const o=s/2*.8,i={top:{x:t,y:e-o},left:{x:t-o,y:e+o*.1},leftCrink:{x:t-o*.5,y:e},right:{x:t+o,y:e+o*.1},rightCrink:{x:t+o*.5,y:e},bottom:{x:t,y:e+o},center:{x:t,y:e+o*.2}};return[[a.MOVE,i.top.x,i.top.y],[a.LINE,i.left.x,i.left.y],[a.LINE,i.leftCrink.x,i.leftCrink.y],[a.LINE,i.top.x,i.top.y],[a.LINE,i.rightCrink.x,i.rightCrink.y],[a.LINE,i.right.x,i.right.y],[a.LINE,i.top.x,i.top.y],[a.MOVE,i.bottom.x,i.bottom.y],[a.LINE,i.left.x,i.left.y],[a.LINE,i.leftCrink.x,i.leftCrink.y],[a.LINE,i.center.x,i.center.y],[a.LINE,i.bottom.x,i.bottom.y],[a.LINE,i.right.x,i.right.y],[a.LINE,i.rightCrink.x,i.rightCrink.y],[a.LINE,i.center.x,i.center.y]]}static D12Path(t,e,s){const o=s/2*.8,i={topLeft:{x:t-o*.4,y:e-o},topRight:{x:t+o*.4,y:e-o},bottomLeft:{x:t-o*.4,y:e+o},bottomRight:{x:t+o*.4,y:e+o},upLeft:{x:t-o*.7,y:e-o*.8},upRight:{x:t+o*.7,y:e-o*.8},downLeft:{x:t-o*.7,y:e+o*.8},downRight:{x:t+o*.7,y:e+o*.8},midLeft:{x:t-o,y:e-o*.2},midRight:{x:t+o,y:e-o*.2},lowMidLeft:{x:t-o,y:e+o*.2},lowMidRight:{x:t+o,y:e+o*.2},center:{x:t,y:e},centerPine:{x:t,y:e-o*.7},leftPine:{x:t-o*.5,y:e+o*.25},rightPine:{x:t+o*.5,y:e+o*.25}};return[[a.MOVE,i.topLeft.x,i.topLeft.y],[a.LINE,i.topRight.x,i.topRight.y],[a.LINE,i.upRight.x,i.upRight.y],[a.LINE,i.midRight.x,i.midRight.y],[a.LINE,i.lowMidRight.x,i.lowMidRight.y],[a.LINE,i.downRight.x,i.downRight.y],[a.LINE,i.bottomRight.x,i.bottomRight.y],[a.LINE,i.bottomLeft.x,i.bottomLeft.y],[a.LINE,i.downLeft.x,i.downLeft.y],[a.LINE,i.lowMidLeft.x,i.lowMidLeft.y],[a.LINE,i.midLeft.x,i.midLeft.y],[a.LINE,i.upLeft.x,i.upLeft.y],[a.LINE,i.topLeft.x,i.topLeft.y],[a.MOVE,i.upLeft.x,i.upLeft.y],[a.LINE,i.centerPine.x,i.centerPine.y],[a.LINE,i.center.x,i.center.y],[a.LINE,i.leftPine.x,i.leftPine.y],[a.LINE,i.midLeft.x,i.midLeft.y],[a.MOVE,i.upRight.x,i.upRight.y],[a.LINE,i.centerPine.x,i.centerPine.y],[a.MOVE,i.center.x,i.center.y],[a.LINE,i.rightPine.x,i.rightPine.y],[a.LINE,i.midRight.x,i.midRight.y],[a.MOVE,i.rightPine.x,i.rightPine.y],[a.LINE,i.bottomRight.x,i.bottomRight.y],[a.MOVE,i.leftPine.x,i.leftPine.y],[a.LINE,i.bottomLeft.x,i.bottomLeft.y]]}static D20Path(t,e,s){const o=s/2*.8,i={top:{x:t,y:e-o},bottom:{x:t,y:e+o},topRight:{x:t+o*.866,y:e-o*.5},bottomRight:{x:t+o*.866,y:e+o*.5},topLeft:{x:t-o*.866,y:e-o*.5},bottomLeft:{x:t-o*.866,y:e+o*.5},topLeftTriangle:{x:t-o*.55,y:e-o*.35},topRightTriangle:{x:t+o*.55,y:e-o*.35},bottomMidTriangle:{x:t,y:e+o*.7}};return[[a.MOVE,i.top.x,i.top.y],[a.LINE,i.topRight.x,i.topRight.y],[a.LINE,i.bottomRight.x,i.bottomRight.y],[a.LINE,i.bottom.x,i.bottom.y],[a.LINE,i.bottomLeft.x,i.bottomLeft.y],[a.LINE,i.topLeft.x,i.topLeft.y],[a.CLOSE],[a.MOVE,i.top.x,i.top.y],[a.LINE,i.topLeftTriangle.x,i.topLeftTriangle.y],[a.LINE,i.bottomLeft.x,i.bottomLeft.y],[a.LINE,i.bottomMidTriangle.x,i.bottomMidTriangle.y],[a.LINE,i.bottomRight.x,i.bottomRight.y],[a.LINE,i.topRightTriangle.x,i.topRightTriangle.y],[a.CLOSE],[a.MOVE,i.topLeft.x,i.topLeft.y],[a.LINE,i.topLeftTriangle.x,i.topLeftTriangle.y],[a.LINE,i.topRightTriangle.x,i.topRightTriangle.y],[a.LINE,i.topRight.x,i.topRight.y],[a.LINE,i.topRightTriangle.x,i.topRightTriangle.y],[a.LINE,i.bottomMidTriangle.x,i.bottomMidTriangle.y],[a.LINE,i.bottom.x,i.bottom.y],[a.LINE,i.bottomMidTriangle.x,i.bottomMidTriangle.y],[a.LINE,i.topLeftTriangle.x,i.topLeftTriangle.y],[a.CLOSE]]}}export{j as C,wn as D,xn as O,Mn as a,bn as b};
