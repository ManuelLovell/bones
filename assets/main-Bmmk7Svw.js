import{O as y,C as t}from"./bsConstants-D1Gb3Lfo.js";import{I as m}from"./bsUtilities-2t2H-Erd.js";const z={d4:"/dice-four.svg",d6:"/dice-six.svg",d8:"/dice-eight.svg",d10:"/dice-ten.svg",d12:"/dice-twelve.svg",d20:"/dice-twenty.svg",d100:"/dice-hundred.svg"},J={d4:"Add a Four-Sided Dice",d6:"Add a Six-Sided Dice",d8:"Add an Eight-Sided Dice",d10:"Add a Ten-Sided Dice",d12:"Add a Twelve-Sided Dice",d20:"Add a Twenty-Sided Dice",d100:"Add a Hundred-Sided Dice"},K={d4:"/gen-boost.svg",d6:"/gen-setback.svg",d8:"/gen-ability.svg",d10:"/gen-difficulty.svg",d12:"/gen-challenge.svg",d20:"/blank.svg",d100:"/gen-proficiency.svg"},Q={d4:"Add a Boost die",d6:"Add a Setback die",d8:"Add an Ability die",d10:"Add a Difficulty die",d12:"Add a Challenge die",d20:"",d100:"Add a Proficiency die"};y.onReady(async()=>{const x="/noscene.svg",S="/cancel-dice.svg",U="/go.svg",P=await y.player.getName(),I=await y.player.getId(),D=await y.room.getMetadata();let C=D[t.DICECOLORSETTING+I]??"#ff0000",T=D[t.SECONDDICECOLORSETTING+I]??"#000000",O=D[t.DICETEXTURESETTING+I]??"default";y.broadcast.onMessage(t.COLORCHANNEL,n=>{const{color:e,secondaryColor:i}=n.data,s=document.querySelector("#swapColorButton");e&&(C=e,document.querySelectorAll(".label-primary").forEach(o=>{o.style.background=e,o.style.color=m(e)}),s.dataset.active===t.FALSE&&(s.style.background=e,s.style.color=m(e))),i&&(T=i,document.querySelectorAll(".label-secondary").forEach(o=>{o.style.background=i,o.style.color=m(i)}),s.dataset.active===t.TRUE&&(s.style.background=i,s.style.color=m(i)))});function F(){return O==="genesys"?{imageMappings:K,textMappings:Q}:{imageMappings:z,textMappings:J}}function u(n){const{imageMappings:e}=F();return e[n]||"default-image.svg"}function p(n){const{textMappings:e}=F();return e[n]||"Unknown Dice Type"}y.room.onMetadataChange(n=>{const e=n[t.DICETEXTURESETTING+I]??"default";if(O==="genesys"&&e!=="genesys"||O!=="genesys"&&e==="genesys"){let i=function(o,r,E){const L=document.getElementById(o);L.src=r,L.title=E};O=e,i("d4Button",u("d4"),p("d4")),i("d6Button",u("d6"),p("d6")),i("d8Button",u("d8"),p("d8")),i("d10Button",u("d10"),p("d10")),i("d12Button",u("d12"),p("d12")),i("d20Button",u("d20"),p("d20")),i("d100Button",u("d100"),p("d100"));const s=document.getElementById("d20Button");s.disabled=e==="genesys",w()}a.style.visibility=e==="genesys"?"hidden":"visible",a.dataset.active=t.FALSE}),await y.popover.open({id:t.EXTENSIONDICECONTROLLERID,url:"/dicecontroller.html",height:356,width:0,anchorOrigin:{horizontal:"RIGHT",vertical:"BOTTOM"},transformOrigin:{horizontal:"RIGHT",vertical:"BOTTOM"},disableClickAway:!0,marginThreshold:120});let R={};function b(n,e,i){const s=document.createElement("input");s.id=n,s.type="image",s.value="0",s.title=i,s.src=e,O==="genesys"&&n==="d20Button"&&(s.disabled=!0),s.classList.add("dice-button"),s.onclick=L=>{L.stopPropagation(),L.preventDefault();const f=a.dataset.active===t.TRUE?E:r,N=a.dataset.active===t.TRUE?T:C,B=n+"_"+N;let g=parseInt(f.innerText);g===0&&(f.hidden=!1),g<20&&(g++,f.innerText=g.toString(),R[B]=g),Object.values(R).reduce((k,M)=>k+M,0)===0?(d.src=S,d.classList.remove("pulse")):(d.src=U,d.classList.add("pulse"))},s.oncontextmenu=L=>{const f=a.dataset.active===t.TRUE?E:r,N=a.dataset.active===t.TRUE?T:C,B=n+"_"+N;let g=parseInt(f.innerText);L.stopPropagation(),L.preventDefault(),g>0&&(g--,f.innerText=g.toString(),R[B]=g),g===0&&(f.hidden=!0),Object.values(R).reduce((k,M)=>k+M,0)===0?(d.src=S,d.classList.remove("pulse")):(d.src=U,d.classList.add("pulse"))};const o=document.createElement("div");o.id=n+"Container",o.classList.add("label-container");const r=document.createElement("label");r.style.background=C,r.style.color=m(C),r.innerText="0",r.id=n+"Label",r.classList.add("label-primary"),r.classList.add("dice-counter"),r.hidden=!0;const E=document.createElement("label");return E.style.background=T,E.style.color=m(T),E.innerText="0",E.id=n+"Label-Secondary",E.classList.add("label-secondary"),E.classList.add("dice-counter"),E.hidden=!0,o.appendChild(s),o.appendChild(r),o.appendChild(E),o}const h=document.createElement("div");h.classList.add("options-container");const c=document.createElement("input");c.id="rollSelfButton",c.type="button",c.classList.add("options-button"),c.value="► ME",c.dataset.active=t.FALSE,c.onclick=()=>{c.dataset.active===t.TRUE?(c.dataset.active=t.FALSE,c.classList.remove("options-active")):(c.dataset.active=t.TRUE,c.classList.add("options-active"))};const a=document.createElement("input");a.id="swapColorButton",a.type="button",a.classList.add("options-button"),a.value="SWAP",a.dataset.active=t.FALSE,a.style.background=a.dataset.active===t.TRUE?T:C,a.style.color=a.dataset.active===t.TRUE?m(T):m(C),a.style.visibility=O==="genesys"?"hidden":"visible",a.onclick=()=>{a.style.background=a.dataset.active===t.FALSE?T:C,a.style.color=a.dataset.active===t.TRUE?m(T):m(C),a.dataset.active=a.dataset.active===t.FALSE?t.TRUE:t.FALSE};const l=document.createElement("input");l.id="rollGMButton",l.type="button",l.classList.add("options-button"),l.value="► GM",l.onclick=()=>{l.dataset.active===t.TRUE?(l.dataset.active=t.FALSE,l.classList.remove("options-active")):(l.dataset.active=t.TRUE,l.classList.add("options-active"))};const v=document.createElement("input");v.id="showLogButton",v.type="button",v.classList.add("options-button"),v.value="MENU",v.dataset.active=t.CLOSE,v.onclick=async()=>{v.dataset.active===t.OPEN?(v.dataset.active=t.CLOSE,await y.popover.setWidth(t.EXTENSIONDICECONTROLLERID,0),v.classList.remove("options-active")):(v.dataset.active=t.OPEN,await y.popover.setWidth(t.EXTENSIONDICECONTROLLERID,220),v.classList.add("options-active"))},h.appendChild(v),h.appendChild(l),h.appendChild(c),h.appendChild(a);const W=b("d4Button",u("d4"),p("d4")),q=b("d6Button",u("d6"),p("d6")),X=b("d8Button",u("d8"),p("d8")),_=b("d10Button",u("d10"),p("d10")),H=b("d12Button",u("d12"),p("d12")),j=b("d20Button",u("d20"),p("d20")),$=b("d100Button",u("d100"),p("d100")),G=await y.scene.isReady(),d=document.createElement("input");d.id="diceWindowOpen",d.type="image",d.src=G?S:x,d.disabled=!G,d.classList.add("dice-button"),d.onclick=async()=>{const n=[];for(const[e,i]of Object.entries(R)){const s=e.split("_")[0].replace("Button","");let o="";O!=="genesys"&&(o="_"+e.split("_")[1]),n.push(`${i}${s}${o}`)}if(n.length!==0){let e=n.join("+");if(O==="genesys"){let L=function(N){let B=N;for(const[g,A]of f)B=B.replace(new RegExp(g,"g"),A);return B};const f=new Map([["d100","proficiency"],["d12","challenge"],["d10","difficulty"],["d8","ability"],["d6","setback"],["d4","boost"]]);e=L(e)}const i=c.dataset.active,s=l.dataset.active;let o="ALL";i==="TRUE"&&(o="SELF"),s==="TRUE"&&(o="GM");const r={},E=new Date().toISOString();r[`${t.EXTENSIONID}/metadata_bonesroll`]={notation:e,created:E,senderName:P,senderId:I,viewers:o},await y.player.setMetadata(r),w()}},d.oncontextmenu=async n=>{n.stopPropagation(),n.preventDefault(),w()},t.BONESDICECONTROLLER.appendChild(h),t.BONESDICECONTROLLER.appendChild(W),t.BONESDICECONTROLLER.appendChild(q),t.BONESDICECONTROLLER.appendChild(X),t.BONESDICECONTROLLER.appendChild(_),t.BONESDICECONTROLLER.appendChild($),t.BONESDICECONTROLLER.appendChild(H),t.BONESDICECONTROLLER.appendChild(j),t.BONESDICECONTROLLER.appendChild(d);function w(){R={};const n=document.querySelectorAll(".dice-counter");d.src=S,d.classList.remove("pulse"),l.dataset.active=t.FALSE,l.classList.remove("options-active"),l.classList.remove("options-hover"),c.dataset.active=t.FALSE,c.classList.remove("options-active"),c.classList.remove("options-hover"),n.forEach(e=>{e.hidden=!0,e.innerText="0"})}y.scene.onReadyChange(n=>{d.disabled=!n,d.src=n?S:x,d.classList.remove("pulse")})});
