import{O as y,C as t}from"./bsConstants-BwvBGUaJ.js";import{I as m}from"./bsUtilities-R5GN5QU1.js";const z={d4:"/dice-four.svg",d6:"/dice-six.svg",d8:"/dice-eight.svg",d10:"/dice-ten.svg",d12:"/dice-twelve.svg",d20:"/dice-twenty.svg",d100:"/dice-hundred.svg"},J={d4:"Add a Four-Sided Dice",d6:"Add a Six-Sided Dice",d8:"Add an Eight-Sided Dice",d10:"Add a Ten-Sided Dice",d12:"Add a Twelve-Sided Dice",d20:"Add a Twenty-Sided Dice",d100:"Add a Hundred-Sided Dice"},K={d4:"/gen-boost.svg",d6:"/gen-setback.svg",d8:"/gen-ability.svg",d10:"/gen-difficulty.svg",d12:"/gen-challenge.svg",d20:"/blank.svg",d100:"/gen-proficiency.svg"},Q={d4:"Add a Boost die",d6:"Add a Setback die",d8:"Add an Ability die",d10:"Add a Difficulty die",d12:"Add a Challenge die",d20:"",d100:"Add a Proficiency die"};y.onReady(async()=>{const x="/noscene.svg",S="/cancel-dice.svg",U="/go.svg",P=await y.player.getName(),I=await y.player.getId(),D=await y.room.getMetadata();let T=D[t.DICECOLORSETTING+I]??"#ff0000",f=D[t.SECONDDICECOLORSETTING+I]??"#000000",O=D[t.DICETEXTURESETTING+I]??"default";y.broadcast.onMessage(t.COLORCHANNEL,e=>{const{color:n,secondaryColor:i}=e.data,s=document.querySelector("#swapColorButton");n&&(document.querySelectorAll(".label-primary").forEach(o=>{o.style.background=n,o.style.color=m(n)}),s.dataset.active===t.FALSE&&(s.style.background=n,s.style.color=m(n))),i&&(document.querySelectorAll(".label-secondary").forEach(o=>{o.style.background=i,o.style.color=m(i)}),s.dataset.active===t.TRUE&&(s.style.background=i,s.style.color=m(i)))});function F(){return O==="genesys"?{imageMappings:K,textMappings:Q}:{imageMappings:z,textMappings:J}}function u(e){const{imageMappings:n}=F();return n[e]||"default-image.svg"}function p(e){const{textMappings:n}=F();return n[e]||"Unknown Dice Type"}y.room.onMetadataChange(e=>{const n=e[t.DICETEXTURESETTING+I]??"default";if(O==="genesys"&&n!=="genesys"||O!=="genesys"&&n==="genesys"){let i=function(o,r,E){const L=document.getElementById(o);L.src=r,L.title=E};O=n,i("d4Button",u("d4"),p("d4")),i("d6Button",u("d6"),p("d6")),i("d8Button",u("d8"),p("d8")),i("d10Button",u("d10"),p("d10")),i("d12Button",u("d12"),p("d12")),i("d20Button",u("d20"),p("d20")),i("d100Button",u("d100"),p("d100"));const s=document.getElementById("d20Button");s.disabled=n==="genesys",w()}a.style.visibility=n==="genesys"?"hidden":"visible",a.dataset.active=t.FALSE}),await y.popover.open({id:t.EXTENSIONDICECONTROLLERID,url:"/dicecontroller.html",height:356,width:0,anchorOrigin:{horizontal:"RIGHT",vertical:"BOTTOM"},transformOrigin:{horizontal:"RIGHT",vertical:"BOTTOM"},disableClickAway:!0,marginThreshold:120});let R={};function b(e,n,i){const s=document.createElement("input");s.id=e,s.type="image",s.value="0",s.title=i,s.src=n,O==="genesys"&&e==="d20Button"&&(s.disabled=!0),s.classList.add("dice-button"),s.onclick=L=>{L.stopPropagation(),L.preventDefault();const C=a.dataset.active===t.TRUE?E:r,N=a.dataset.active===t.TRUE?f:T,B=e+"_"+N;let g=parseInt(C.innerText);g===0&&(C.hidden=!1),g<20&&(g++,C.innerText=g.toString(),R[B]=g),Object.values(R).reduce((k,M)=>k+M,0)===0?(d.src=S,d.classList.remove("pulse")):(d.src=U,d.classList.add("pulse"))},s.oncontextmenu=L=>{const C=a.dataset.active===t.TRUE?E:r,N=a.dataset.active===t.TRUE?f:T,B=e+"_"+N;let g=parseInt(C.innerText);L.stopPropagation(),L.preventDefault(),g>0&&(g--,C.innerText=g.toString(),R[B]=g),g===0&&(C.hidden=!0),Object.values(R).reduce((k,M)=>k+M,0)===0?(d.src=S,d.classList.remove("pulse")):(d.src=U,d.classList.add("pulse"))};const o=document.createElement("div");o.id=e+"Container",o.classList.add("label-container");const r=document.createElement("label");r.style.background=T,r.style.color=m(T),r.innerText="0",r.id=e+"Label",r.classList.add("label-primary"),r.classList.add("dice-counter"),r.hidden=!0;const E=document.createElement("label");return E.style.background=f,E.style.color=m(f),E.innerText="0",E.id=e+"Label-Secondary",E.classList.add("label-secondary"),E.classList.add("dice-counter"),E.hidden=!0,o.appendChild(s),o.appendChild(r),o.appendChild(E),o}const h=document.createElement("div");h.classList.add("options-container");const c=document.createElement("input");c.id="rollSelfButton",c.type="button",c.classList.add("options-button"),c.value="► ME",c.dataset.active=t.FALSE,c.onclick=()=>{c.dataset.active===t.TRUE?(c.dataset.active=t.FALSE,c.classList.remove("options-active")):(c.dataset.active=t.TRUE,c.classList.add("options-active"))};const a=document.createElement("input");a.id="swapColorButton",a.type="button",a.classList.add("options-button"),a.value="SWAP",a.dataset.active=t.FALSE,a.style.background=a.dataset.active===t.TRUE?f:T,a.style.color=a.dataset.active===t.TRUE?m(f):m(T),a.style.visibility=O==="genesys"?"hidden":"visible",a.onclick=()=>{a.style.background=a.dataset.active===t.FALSE?f:T,a.style.color=a.dataset.active===t.TRUE?m(f):m(T),a.dataset.active=a.dataset.active===t.FALSE?t.TRUE:t.FALSE};const l=document.createElement("input");l.id="rollGMButton",l.type="button",l.classList.add("options-button"),l.value="► GM",l.onclick=()=>{l.dataset.active===t.TRUE?(l.dataset.active=t.FALSE,l.classList.remove("options-active")):(l.dataset.active=t.TRUE,l.classList.add("options-active"))};const v=document.createElement("input");v.id="showLogButton",v.type="button",v.classList.add("options-button"),v.value="MENU",v.dataset.active=t.CLOSE,v.onclick=async()=>{v.dataset.active===t.OPEN?(v.dataset.active=t.CLOSE,await y.popover.setWidth(t.EXTENSIONDICECONTROLLERID,0),v.classList.remove("options-active")):(v.dataset.active=t.OPEN,await y.popover.setWidth(t.EXTENSIONDICECONTROLLERID,220),v.classList.add("options-active"))},h.appendChild(v),h.appendChild(l),h.appendChild(c),h.appendChild(a);const W=b("d4Button",u("d4"),p("d4")),q=b("d6Button",u("d6"),p("d6")),X=b("d8Button",u("d8"),p("d8")),_=b("d10Button",u("d10"),p("d10")),H=b("d12Button",u("d12"),p("d12")),j=b("d20Button",u("d20"),p("d20")),$=b("d100Button",u("d100"),p("d100")),G=await y.scene.isReady(),d=document.createElement("input");d.id="diceWindowOpen",d.type="image",d.src=G?S:x,d.disabled=!G,d.classList.add("dice-button"),d.onclick=async()=>{const e=[];for(const[n,i]of Object.entries(R)){const s=n.split("_")[0].replace("Button","");let o="";O!=="genesys"&&(o="_"+n.split("_")[1]),e.push(`${i}${s}${o}`)}if(e.length!==0){let n=e.join("+");if(O==="genesys"){let L=function(N){let B=N;for(const[g,A]of C)B=B.replace(new RegExp(g,"g"),A);return B};const C=new Map([["d100","proficiency"],["d12","challenge"],["d10","difficulty"],["d8","ability"],["d6","setback"],["d4","boost"]]);n=L(n)}const i=c.dataset.active,s=l.dataset.active;let o="ALL";i==="TRUE"&&(o="SELF"),s==="TRUE"&&(o="GM");const r={},E=new Date().toISOString();r[`${t.EXTENSIONID}/metadata_bonesroll`]={notation:n,created:E,senderName:P,senderId:I,viewers:o},await y.player.setMetadata(r),w()}},d.oncontextmenu=async e=>{e.stopPropagation(),e.preventDefault(),w()},t.BONESDICECONTROLLER.appendChild(h),t.BONESDICECONTROLLER.appendChild(W),t.BONESDICECONTROLLER.appendChild(q),t.BONESDICECONTROLLER.appendChild(X),t.BONESDICECONTROLLER.appendChild(_),t.BONESDICECONTROLLER.appendChild($),t.BONESDICECONTROLLER.appendChild(H),t.BONESDICECONTROLLER.appendChild(j),t.BONESDICECONTROLLER.appendChild(d);function w(){R={};const e=document.querySelectorAll(".dice-counter");d.src=S,d.classList.remove("pulse"),l.dataset.active=t.FALSE,l.classList.remove("options-active"),l.classList.remove("options-hover"),c.dataset.active=t.FALSE,c.classList.remove("options-active"),c.classList.remove("options-hover"),e.forEach(n=>{n.hidden=!0,n.innerText="0"})}y.scene.onReadyChange(e=>{d.disabled=!e,d.src=e?S:x,d.classList.remove("pulse")})});
