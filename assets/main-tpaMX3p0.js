import{C as q,O as S}from"./bsConstants-E4N5t5Rc.js";import{B as F}from"./bsSceneCache-qAmaSuWl.js";const x=(()=>{/*!
* Copyright (c) 2021-2023 Momo Bassit.
* Licensed under the MIT License (MIT)
* https://github.com/mdbassit/Coloris
* Version: 0.21.1
* NPM: https://github.com/melloware/coloris-npm
*/return((y,n,f,h)=>{const m=n.createElement("canvas").getContext("2d"),L={r:0,g:0,b:0,h:0,s:0,v:0,a:1};let T,c,w,b,z,E,D,R,M,ee,N,A,d,W,I,te,k={};const a={el:"[data-coloris]",parent:"body",theme:"default",themeMode:"light",rtl:!1,wrap:!0,margin:2,format:"hex",formatToggle:!1,swatches:[],swatchesOnly:!1,alpha:!0,forceAlpha:!1,focusInput:!0,selectInput:!1,inline:!1,defaultColor:"#000000",clearButton:!1,clearLabel:"Clear",closeButton:!1,closeLabel:"Close",onChange:()=>h,a11y:{open:"Open color picker",close:"Close color picker",clear:"Clear the selected color",marker:"Saturation: {s}. Brightness: {v}.",hueSlider:"Hue slider",alphaSlider:"Opacity slider",input:"Color value field",format:"Color format",swatch:"Color swatch",instruction:"Saturation and brightness selector. Use up, down, left and right arrow keys to select."}},G={};let le="",V={},j=!1;function K(e){if(typeof e=="object")for(const t in e)switch(t){case"el":re(e.el),e.wrap!==!1&&U(e.el);break;case"parent":T=n.querySelector(e.parent),T&&(T.appendChild(c),a.parent=e.parent,T===n.body&&(T=h));break;case"themeMode":a.themeMode=e.themeMode,e.themeMode==="auto"&&y.matchMedia&&y.matchMedia("(prefers-color-scheme: dark)").matches&&(a.themeMode="dark");case"theme":e.theme&&(a.theme=e.theme),c.className=`clr-picker clr-${a.theme} clr-${a.themeMode}`,a.inline&&X();break;case"rtl":a.rtl=!!e.rtl,n.querySelectorAll(".clr-field").forEach(o=>o.classList.toggle("clr-rtl",a.rtl));break;case"margin":e.margin*=1,a.margin=isNaN(e.margin)?a.margin:e.margin;break;case"wrap":e.el&&e.wrap&&U(e.el);break;case"formatToggle":a.formatToggle=!!e.formatToggle,v("clr-format").style.display=a.formatToggle?"block":"none",a.formatToggle&&(a.format="auto");break;case"swatches":if(Array.isArray(e.swatches)){const o=[];e.swatches.forEach((i,u)=>{o.push(`<button type="button" id="clr-swatch-${u}" aria-labelledby="clr-swatch-label clr-swatch-${u}" style="color: ${i};">${i}</button>`)}),v("clr-swatches").innerHTML=o.length?`<div>${o.join("")}</div>`:"",a.swatches=e.swatches.slice()}break;case"swatchesOnly":a.swatchesOnly=!!e.swatchesOnly,c.setAttribute("data-minimal",a.swatchesOnly);break;case"alpha":a.alpha=!!e.alpha,c.setAttribute("data-alpha",a.alpha);break;case"inline":if(a.inline=!!e.inline,c.setAttribute("data-inline",a.inline),a.inline){const o=e.defaultColor||a.defaultColor;W=oe(o),X(),Y(o)}break;case"clearButton":typeof e.clearButton=="object"&&(e.clearButton.label&&(a.clearLabel=e.clearButton.label,D.innerHTML=a.clearLabel),e.clearButton=e.clearButton.show),a.clearButton=!!e.clearButton,D.style.display=a.clearButton?"block":"none";break;case"clearLabel":a.clearLabel=e.clearLabel,D.innerHTML=a.clearLabel;break;case"closeButton":a.closeButton=!!e.closeButton,a.closeButton?c.insertBefore(R,z):z.appendChild(R);break;case"closeLabel":a.closeLabel=e.closeLabel,R.innerHTML=a.closeLabel;break;case"a11y":const l=e.a11y;let r=!1;if(typeof l=="object")for(const o in l)l[o]&&a.a11y[o]&&(a.a11y[o]=l[o],r=!0);if(r){const o=v("clr-open-label"),i=v("clr-swatch-label");o.innerHTML=a.a11y.open,i.innerHTML=a.a11y.swatch,R.setAttribute("aria-label",a.a11y.close),D.setAttribute("aria-label",a.a11y.clear),M.setAttribute("aria-label",a.a11y.hueSlider),N.setAttribute("aria-label",a.a11y.alphaSlider),E.setAttribute("aria-label",a.a11y.input),w.setAttribute("aria-label",a.a11y.instruction)}break;default:a[t]=e[t]}}function he(e,t){typeof e=="string"&&typeof t=="object"&&(G[e]=t,j=!0)}function ye(e){delete G[e],Object.keys(G).length===0&&(j=!1,e===le&&ae())}function ie(e){if(j){const t=["el","wrap","rtl","inline","defaultColor","a11y"];for(let l in G){const r=G[l];if(e.matches(l)){le=l,V={},t.forEach(o=>delete r[o]);for(let o in r)V[o]=Array.isArray(a[o])?a[o].slice():a[o];K(r);break}}}}function ae(){Object.keys(V).length>0&&(K(V),le="",V={})}function re(e){s(n,"click",e,t=>{a.inline||(ie(t.target),d=t.target,I=d.value,W=oe(I),c.classList.add("clr-open"),X(),Y(I),(a.focusInput||a.selectInput)&&(E.focus({preventScroll:!0}),E.setSelectionRange(d.selectionStart,d.selectionEnd)),a.selectInput&&E.select(),(te||a.swatchesOnly)&&fe().shift().focus(),d.dispatchEvent(new Event("open",{bubbles:!0})))}),s(n,"input",e,t=>{const l=t.target.parentNode;l.classList.contains("clr-field")&&(l.style.color=t.target.value)})}function X(){if(!c||!d&&!a.inline)return;const e=T,t=y.scrollY,l=c.offsetWidth,r=c.offsetHeight,o={left:!1,top:!1};let i,u,C,p={x:0,y:0};if(e&&(i=y.getComputedStyle(e),u=parseFloat(i.marginTop),C=parseFloat(i.borderTopWidth),p=e.getBoundingClientRect(),p.y+=C+t),!a.inline){const g=d.getBoundingClientRect();let O=g.x,H=t+g.y+g.height+a.margin;e?(O-=p.x,H-=p.y,O+l>e.clientWidth&&(O+=g.width-l,o.left=!0),H+r>e.clientHeight-u&&r+a.margin<=g.top-(p.y-t)&&(H-=g.height+r+a.margin*2,o.top=!0),H+=e.scrollTop):(O+l>n.documentElement.clientWidth&&(O+=g.width-l,o.left=!0),H+r-t>n.documentElement.clientHeight&&r+a.margin<=g.top&&(H=t+g.y-r-a.margin,o.top=!0)),c.classList.toggle("clr-left",o.left),c.classList.toggle("clr-top",o.top),c.style.left=`${O}px`,c.style.top=`${H}px`,p.x+=c.offsetLeft,p.y+=c.offsetTop}k={width:w.offsetWidth,height:w.offsetHeight,x:w.offsetLeft+p.x,y:w.offsetTop+p.y}}function U(e){n.querySelectorAll(e).forEach(t=>{const l=t.parentNode;if(!l.classList.contains("clr-field")){const r=n.createElement("div");let o="clr-field";(a.rtl||t.classList.contains("clr-rtl"))&&(o+=" clr-rtl"),r.innerHTML='<button type="button" aria-labelledby="clr-open-label"></button>',l.insertBefore(r,t),r.setAttribute("class",o),r.style.color=t.value,r.appendChild(t)}})}function P(e){if(d&&!a.inline){const t=d;e&&(d=h,I!==t.value&&(t.value=I,t.dispatchEvent(new Event("input",{bubbles:!0})))),setTimeout(()=>{I!==t.value&&t.dispatchEvent(new Event("change",{bubbles:!0}))}),c.classList.remove("clr-open"),j&&ae(),t.dispatchEvent(new Event("close",{bubbles:!0})),a.focusInput&&t.focus({preventScroll:!0}),d=h}}function Y(e){const t=Ce(e),l=Ee(t);se(l.s,l.v),J(t,l),M.value=l.h,c.style.color=`hsl(${l.h}, 100%, 50%)`,ee.style.left=`${l.h/360*100}%`,b.style.left=`${k.width*l.s/100}px`,b.style.top=`${k.height-k.height*l.v/100}px`,N.value=l.a*100,A.style.left=`${l.a*100}%`}function oe(e){const t=e.substring(0,3).toLowerCase();return t==="rgb"||t==="hsl"?t:"hex"}function B(e){e=e!==h?e:E.value,d&&(d.value=e,d.dispatchEvent(new Event("input",{bubbles:!0}))),a.onChange&&a.onChange.call(y,e,d),n.dispatchEvent(new CustomEvent("coloris:pick",{detail:{color:e,currentEl:d}}))}function ce(e,t){const l={h:M.value*1,s:e/k.width*100,v:100-t/k.height*100,a:N.value/100},r=we(l);se(l.s,l.v),J(r,l),B()}function se(e,t){let l=a.a11y.marker;e=e.toFixed(1)*1,t=t.toFixed(1)*1,l=l.replace("{s}",e),l=l.replace("{v}",t),b.setAttribute("aria-label",l)}function be(e){return{pageX:e.changedTouches?e.changedTouches[0].pageX:e.pageX,pageY:e.changedTouches?e.changedTouches[0].pageY:e.pageY}}function $(e){const t=be(e);let l=t.pageX-k.x,r=t.pageY-k.y;T&&(r+=T.scrollTop),ue(l,r),e.preventDefault(),e.stopPropagation()}function ve(e,t){let l=b.style.left.replace("px","")*1+e,r=b.style.top.replace("px","")*1+t;ue(l,r)}function ue(e,t){e=e<0?0:e>k.width?k.width:e,t=t<0?0:t>k.height?k.height:t,b.style.left=`${e}px`,b.style.top=`${t}px`,ce(e,t),b.focus()}function J(e,t){e===void 0&&(e={}),t===void 0&&(t={});let l=a.format;for(const i in e)L[i]=e[i];for(const i in t)L[i]=t[i];const r=xe(L),o=r.substring(0,7);switch(b.style.color=o,A.parentNode.style.color=o,A.style.color=r,z.style.color=r,w.style.display="none",w.offsetHeight,w.style.display="",A.nextElementSibling.style.display="none",A.nextElementSibling.offsetHeight,A.nextElementSibling.style.display="",l==="mixed"?l=L.a===1?"hex":"rgb":l==="auto"&&(l=W),l){case"hex":E.value=r;break;case"rgb":E.value=Le(L);break;case"hsl":E.value=Te(ke(L));break}n.querySelector(`.clr-format [value="${l}"]`).checked=!0}function ge(){const e=M.value*1,t=b.style.left.replace("px","")*1,l=b.style.top.replace("px","")*1;c.style.color=`hsl(${e}, 100%, 50%)`,ee.style.left=`${e/360*100}%`,ce(t,l)}function me(){const e=N.value/100;A.style.left=`${e*100}%`,J({a:e}),B()}function we(e){const t=e.s/100,l=e.v/100;let r=t*l,o=e.h/60,i=r*(1-f.abs(o%2-1)),u=l-r;r=r+u,i=i+u;const C=f.floor(o)%6,p=[r,i,u,u,i,r][C],g=[i,r,r,i,u,u][C],O=[u,u,i,r,r,i][C];return{r:f.round(p*255),g:f.round(g*255),b:f.round(O*255),a:e.a}}function ke(e){const t=e.v/100,l=t*(1-e.s/100/2);let r;return l>0&&l<1&&(r=f.round((t-l)/f.min(l,1-l)*100)),{h:e.h,s:r||0,l:f.round(l*100),a:e.a}}function Ee(e){const t=e.r/255,l=e.g/255,r=e.b/255,o=f.max(t,l,r),i=f.min(t,l,r),u=o-i,C=o;let p=0,g=0;return u&&(o===t&&(p=(l-r)/u),o===l&&(p=2+(r-t)/u),o===r&&(p=4+(t-l)/u),o&&(g=u/o)),p=f.floor(p*60),{h:p<0?p+360:p,s:f.round(g*100),v:f.round(C*100),a:e.a}}function Ce(e){const t=/^((rgba)|rgb)[\D]+([\d.]+)[\D]+([\d.]+)[\D]+([\d.]+)[\D]*?([\d.]+|$)/i;let l,r;return m.fillStyle="#000",m.fillStyle=e,l=t.exec(m.fillStyle),l?(r={r:l[3]*1,g:l[4]*1,b:l[5]*1,a:l[6]*1},r.a=+r.a.toFixed(2)):(l=m.fillStyle.replace("#","").match(/.{2}/g).map(o=>parseInt(o,16)),r={r:l[0],g:l[1],b:l[2],a:1}),r}function xe(e){let t=e.r.toString(16),l=e.g.toString(16),r=e.b.toString(16),o="";if(e.r<16&&(t="0"+t),e.g<16&&(l="0"+l),e.b<16&&(r="0"+r),a.alpha&&(e.a<1||a.forceAlpha)){const i=e.a*255|0;o=i.toString(16),i<16&&(o="0"+o)}return"#"+t+l+r+o}function Le(e){return!a.alpha||e.a===1&&!a.forceAlpha?`rgb(${e.r}, ${e.g}, ${e.b})`:`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`}function Te(e){return!a.alpha||e.a===1&&!a.forceAlpha?`hsl(${e.h}, ${e.s}%, ${e.l}%)`:`hsla(${e.h}, ${e.s}%, ${e.l}%, ${e.a})`}function Se(){n.getElementById("clr-picker")||(T=h,c=n.createElement("div"),c.setAttribute("id","clr-picker"),c.className="clr-picker",c.innerHTML=`<input id="clr-color-value" name="clr-color-value" class="clr-color" type="text" value="" spellcheck="false" aria-label="${a.a11y.input}"><div id="clr-color-area" class="clr-gradient" role="application" aria-label="${a.a11y.instruction}"><div id="clr-color-marker" class="clr-marker" tabindex="0"></div></div><div class="clr-hue"><input id="clr-hue-slider" name="clr-hue-slider" type="range" min="0" max="360" step="1" aria-label="${a.a11y.hueSlider}"><div id="clr-hue-marker"></div></div><div class="clr-alpha"><input id="clr-alpha-slider" name="clr-alpha-slider" type="range" min="0" max="100" step="1" aria-label="${a.a11y.alphaSlider}"><div id="clr-alpha-marker"></div><span></span></div><div id="clr-format" class="clr-format"><fieldset class="clr-segmented"><legend>${a.a11y.format}</legend><input id="clr-f1" type="radio" name="clr-format" value="hex"><label for="clr-f1">Hex</label><input id="clr-f2" type="radio" name="clr-format" value="rgb"><label for="clr-f2">RGB</label><input id="clr-f3" type="radio" name="clr-format" value="hsl"><label for="clr-f3">HSL</label><span></span></fieldset></div><div id="clr-swatches" class="clr-swatches"></div><button type="button" id="clr-clear" class="clr-clear" aria-label="${a.a11y.clear}">${a.clearLabel}</button><div id="clr-color-preview" class="clr-preview"><button type="button" id="clr-close" class="clr-close" aria-label="${a.a11y.close}">${a.closeLabel}</button></div><span id="clr-open-label" hidden>${a.a11y.open}</span><span id="clr-swatch-label" hidden>${a.a11y.swatch}</span>`,n.body.appendChild(c),w=v("clr-color-area"),b=v("clr-color-marker"),D=v("clr-clear"),R=v("clr-close"),z=v("clr-color-preview"),E=v("clr-color-value"),M=v("clr-hue-slider"),ee=v("clr-hue-marker"),N=v("clr-alpha-slider"),A=v("clr-alpha-marker"),re(a.el),U(a.el),s(c,"mousedown",e=>{c.classList.remove("clr-keyboard-nav"),e.stopPropagation()}),s(w,"mousedown",e=>{s(n,"mousemove",$)}),s(w,"touchstart",e=>{n.addEventListener("touchmove",$,{passive:!1})}),s(b,"mousedown",e=>{s(n,"mousemove",$)}),s(b,"touchstart",e=>{n.addEventListener("touchmove",$,{passive:!1})}),s(E,"change",e=>{const t=E.value;if(d||a.inline){const l=t===""?t:Y(t);B(l)}}),s(D,"click",e=>{B(""),P()}),s(R,"click",e=>{B(),P()}),s(v("clr-format"),"click",".clr-format input",e=>{W=e.target.value,J(),B()}),s(c,"click",".clr-swatches button",e=>{Y(e.target.textContent),B(),a.swatchesOnly&&P()}),s(n,"mouseup",e=>{n.removeEventListener("mousemove",$)}),s(n,"touchend",e=>{n.removeEventListener("touchmove",$)}),s(n,"mousedown",e=>{te=!1,c.classList.remove("clr-keyboard-nav"),P()}),s(n,"keydown",e=>{const t=e.key,l=e.target,r=e.shiftKey;if(t==="Escape"?P(!0):["Tab","ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(t)&&(te=!0,c.classList.add("clr-keyboard-nav")),t==="Tab"&&l.matches(".clr-picker *")){const i=fe(),u=i.shift(),C=i.pop();r&&l===u?(C.focus(),e.preventDefault()):!r&&l===C&&(u.focus(),e.preventDefault())}}),s(n,"click",".clr-field button",e=>{j&&ae(),e.target.nextElementSibling.dispatchEvent(new Event("click",{bubbles:!0}))}),s(b,"keydown",e=>{const t={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};Object.keys(t).includes(e.key)&&(ve(...t[e.key]),e.preventDefault())}),s(w,"click",$),s(M,"input",ge),s(N,"input",me))}function fe(){return Array.from(c.querySelectorAll("input, button")).filter(l=>!!l.offsetWidth)}function v(e){return n.getElementById(e)}function s(e,t,l,r){const o=Element.prototype.matches||Element.prototype.msMatchesSelector;typeof l=="string"?e.addEventListener(t,i=>{o.call(i.target,l)&&r.call(i.target,i)}):(r=l,e.addEventListener(t,r))}function Q(e,t){t=t!==h?t:[],n.readyState!=="loading"?e(...t):n.addEventListener("DOMContentLoaded",()=>{e(...t)})}NodeList!==h&&NodeList.prototype&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach);function Ae(e,t){d=t,I=d.value,ie(t),W=oe(e),X(),Y(e),B(),I!==e&&d.dispatchEvent(new Event("change",{bubbles:!0}))}const ne=(()=>{const e={init:Se,set:K,wrap:U,close:P,setInstance:he,setColor:Ae,removeInstance:ye,updatePosition:X,ready:Q};function t(l){Q(()=>{l&&(typeof l=="string"?re(l):K(l))})}for(const l in e)t[l]=function(){for(var r=arguments.length,o=new Array(r),i=0;i<r;i++)o[i]=arguments[i];Q(e[l],o)};return Q(()=>{y.addEventListener("resize",l=>{t.updatePosition()}),y.addEventListener("scroll",l=>{t.updatePosition()})}),t})();return ne.coloris=ne,ne})(window,document,Math)})();x.coloris;x.init;x.set;x.wrap;x.close;x.setInstance;x.removeInstance;x.updatePosition;q.BONESENTRY.innerHTML=`
    <div class="header">Dice Color</div>
    <div id="colorisContainer" class='coloris-container full'></div>
    <div class="header">Dice Choice</div>
    <div id="selectContainer" class="select"></div>
    <div class="header">Dice Log</div>
    <div id="rollContainer"><ul id="rollLog"></ul></div>
`;let Z,_;S.onReady(async()=>{await F.InitializeCache(),F.SetupHandlers(),await pe(),Be(),Oe(),setInterval(Ie,2e3)});async function Ie(){const y=await S.viewport.getHeight(),n=await S.viewport.getWidth();(y!==Z||n!==_)&&(await S.popover.close(q.EXTENSIONDICECONTROLLERID),await pe(),Z=y,_=n)}async function pe(){try{await de()}catch{setTimeout(async()=>{await de()},2e3)}}async function de(){Z=await S.viewport.getHeight(),_=await S.viewport.getWidth(),await S.popover.open({id:q.EXTENSIONDICECONTROLLERID,url:"/dicecontroller.html",height:54,width:54,anchorPosition:{top:Z-75,left:_-20},anchorReference:"POSITION",anchorOrigin:{vertical:"BOTTOM",horizontal:"RIGHT"},transformOrigin:{vertical:"BOTTOM",horizontal:"RIGHT"},disableClickAway:!0,hidePaper:!0})}function Be(){let y;const n=document.getElementById("colorisContainer"),f=document.createElement("input");f.type="text",f.classList.add("coloris"),f.id="diceColoris",f.value=F.playerDiceColor,f.maxLength=7,f.oninput=async h=>{if(!h||!h.target)return;const m=h.target;clearTimeout(y),y=setTimeout(async()=>{/#[a-f0-9]{6}/.test(m.value)&&await S.room.setMetadata({[q.DICECOLORSETTING+F.playerId]:m.value})},400)},n.appendChild(f),x.init(),x({alpha:!1,theme:"polaroid",closeButton:!0,themeMode:"dark",el:"#diceColoris"})}function Oe(){const y=document.getElementById("selectContainer"),n=document.createElement("select");n.id="textureSelect",[{text:"Astral",value:"astral"},{text:"Bronze",value:"bronze03"},{text:"Cheetah",value:"cheetah"},{text:"Cloudy",value:"cloudy"},{text:"Dragon",value:"dragon"},{text:"Feather",value:"feather"},{text:"Fire",value:"fire"},{text:"Glitter",value:"glitter"},{text:"Ice",value:"ice"},{text:"Marble",value:"marble"},{text:"Metal",value:"metal"},{text:"Skulls",value:"skulls"},{text:"Stained Glass",value:"stainedglass"},{text:"Stars",value:"stars"},{text:"Stone",value:"stone"},{text:"Tiger",value:"tiger"},{text:"Water",value:"water"},{text:"Wood",value:"wood"}].forEach(h=>{const m=document.createElement("option");m.setAttribute("value",h.value);const L=document.createTextNode(h.text);m.appendChild(L),n.appendChild(m)}),n.value=F.playerDiceTexture,n.onchange=async h=>{const m=h.currentTarget;await S.room.setMetadata({[q.DICETEXTURESETTING+F.playerId]:m.value})},y.appendChild(n)}
