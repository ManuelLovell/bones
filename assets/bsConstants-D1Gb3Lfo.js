(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const u of n.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();var S=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class oe{constructor(t){this.messageBus=t}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return S(this,void 0,void 0,function*(){const{selection:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return t})}select(t,e){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:t,replace:e})})}deselect(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:t})})}getName(){return S(this,void 0,void 0,function*(){const{name:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return t})}setName(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:t})})}getColor(){return S(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return t})}setColor(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:t})})}getSyncView(){return S(this,void 0,void 0,function*(){const{syncView:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return t})}setSyncView(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:t})})}getId(){return S(this,void 0,void 0,function*(){const{id:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return t})}getRole(){return S(this,void 0,void 0,function*(){const{role:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return t})}getMetadata(){return S(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return t})}setMetadata(t){return S(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:t})})}hasPermission(t){return S(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:s}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return s.indexOf(t)>-1})}getConnectionId(){return S(this,void 0,void 0,function*(){const{connectionId:t}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return t})}onChange(t){const e=s=>{t(s.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",e)}}}var P=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class re{constructor(t){this.messageBus=t}reset(){return P(this,void 0,void 0,function*(){const{transform:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return t})}animateTo(t){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:t})})}animateToBounds(t){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:t})})}getPosition(){return P(this,void 0,void 0,function*(){const{position:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return t})}setPosition(t){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:t})})}getScale(){return P(this,void 0,void 0,function*(){const{scale:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return t})}setScale(t){return P(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:t})})}getWidth(){return P(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return t})}getHeight(){return P(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return t})}transformPoint(t){return P(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:t});return e})}inverseTransformPoint(t){return P(this,void 0,void 0,function*(){const{point:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:t});return e})}}function ue(i){return typeof i.id=="string"}var it={exports:{}},Ut;function ae(){if(Ut)return it.exports;Ut=1;var i=typeof Reflect=="object"?Reflect:null,t=i&&typeof i.apply=="function"?i.apply:function(l,E,y){return Function.prototype.apply.call(l,E,y)},e;i&&typeof i.ownKeys=="function"?e=i.ownKeys:Object.getOwnPropertySymbols?e=function(l){return Object.getOwnPropertyNames(l).concat(Object.getOwnPropertySymbols(l))}:e=function(l){return Object.getOwnPropertyNames(l)};function s(_){console&&console.warn&&console.warn(_)}var o=Number.isNaN||function(l){return l!==l};function n(){n.init.call(this)}it.exports=n,it.exports.once=C,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var u=10;function h(_){if(typeof _!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof _)}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(_){if(typeof _!="number"||_<0||o(_))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+_+".");u=_}}),n.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(l){if(typeof l!="number"||l<0||o(l))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+l+".");return this._maxListeners=l,this};function f(_){return _._maxListeners===void 0?n.defaultMaxListeners:_._maxListeners}n.prototype.getMaxListeners=function(){return f(this)},n.prototype.emit=function(l){for(var E=[],y=1;y<arguments.length;y++)E.push(arguments[y]);var O=l==="error",v=this._events;if(v!==void 0)O=O&&v.error===void 0;else if(!O)return!1;if(O){var m;if(E.length>0&&(m=E[0]),m instanceof Error)throw m;var D=new Error("Unhandled error."+(m?" ("+m.message+")":""));throw D.context=m,D}var Q=v[l];if(Q===void 0)return!1;if(typeof Q=="function")t(Q,this,E);else for(var Gt=Q.length,se=g(Q,Gt),y=0;y<Gt;++y)t(se[y],this,E);return!0};function a(_,l,E,y){var O,v,m;if(h(E),v=_._events,v===void 0?(v=_._events=Object.create(null),_._eventsCount=0):(v.newListener!==void 0&&(_.emit("newListener",l,E.listener?E.listener:E),v=_._events),m=v[l]),m===void 0)m=v[l]=E,++_._eventsCount;else if(typeof m=="function"?m=v[l]=y?[E,m]:[m,E]:y?m.unshift(E):m.push(E),O=f(_),O>0&&m.length>O&&!m.warned){m.warned=!0;var D=new Error("Possible EventEmitter memory leak detected. "+m.length+" "+String(l)+" listeners added. Use emitter.setMaxListeners() to increase limit");D.name="MaxListenersExceededWarning",D.emitter=_,D.type=l,D.count=m.length,s(D)}return _}n.prototype.addListener=function(l,E){return a(this,l,E,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(l,E){return a(this,l,E,!0)};function r(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(_,l,E){var y={fired:!1,wrapFn:void 0,target:_,type:l,listener:E},O=r.bind(y);return O.listener=E,y.wrapFn=O,O}n.prototype.once=function(l,E){return h(E),this.on(l,c(this,l,E)),this},n.prototype.prependOnceListener=function(l,E){return h(E),this.prependListener(l,c(this,l,E)),this},n.prototype.removeListener=function(l,E){var y,O,v,m,D;if(h(E),O=this._events,O===void 0)return this;if(y=O[l],y===void 0)return this;if(y===E||y.listener===E)--this._eventsCount===0?this._events=Object.create(null):(delete O[l],O.removeListener&&this.emit("removeListener",l,y.listener||E));else if(typeof y!="function"){for(v=-1,m=y.length-1;m>=0;m--)if(y[m]===E||y[m].listener===E){D=y[m].listener,v=m;break}if(v<0)return this;v===0?y.shift():A(y,v),y.length===1&&(O[l]=y[0]),O.removeListener!==void 0&&this.emit("removeListener",l,D||E)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(l){var E,y,O;if(y=this._events,y===void 0)return this;if(y.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):y[l]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete y[l]),this;if(arguments.length===0){var v=Object.keys(y),m;for(O=0;O<v.length;++O)m=v[O],m!=="removeListener"&&this.removeAllListeners(m);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(E=y[l],typeof E=="function")this.removeListener(l,E);else if(E!==void 0)for(O=E.length-1;O>=0;O--)this.removeListener(l,E[O]);return this};function T(_,l,E){var y=_._events;if(y===void 0)return[];var O=y[l];return O===void 0?[]:typeof O=="function"?E?[O.listener||O]:[O]:E?N(O):g(O,O.length)}n.prototype.listeners=function(l){return T(this,l,!0)},n.prototype.rawListeners=function(l){return T(this,l,!1)},n.listenerCount=function(_,l){return typeof _.listenerCount=="function"?_.listenerCount(l):p.call(_,l)},n.prototype.listenerCount=p;function p(_){var l=this._events;if(l!==void 0){var E=l[_];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}n.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]};function g(_,l){for(var E=new Array(l),y=0;y<l;++y)E[y]=_[y];return E}function A(_,l){for(;l+1<_.length;l++)_[l]=_[l+1];_.pop()}function N(_){for(var l=new Array(_.length),E=0;E<l.length;++E)l[E]=_[E].listener||_[E];return l}function C(_,l){return new Promise(function(E,y){function O(m){_.removeListener(l,v),y(m)}function v(){typeof _.removeListener=="function"&&_.removeListener("error",O),E([].slice.call(arguments))}V(_,l,v,{once:!0}),l!=="error"&&L(_,O,{once:!0})})}function L(_,l,E){typeof _.on=="function"&&V(_,"error",l,E)}function V(_,l,E,y){if(typeof _.on=="function")y.once?_.once(l,E):_.on(l,E);else if(typeof _.addEventListener=="function")_.addEventListener(l,function O(v){y.once&&_.removeEventListener(l,O),E(v)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof _)}return it.exports}var de=ae();let st;const ce=new Uint8Array(16);function fe(){if(!st&&(st=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!st))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return st(ce)}const B=[];for(let i=0;i<256;++i)B.push((i+256).toString(16).slice(1));function he(i,t=0){return B[i[t+0]]+B[i[t+1]]+B[i[t+2]]+B[i[t+3]]+"-"+B[i[t+4]]+B[i[t+5]]+"-"+B[i[t+6]]+B[i[t+7]]+"-"+B[i[t+8]]+B[i[t+9]]+"-"+B[i[t+10]]+B[i[t+11]]+B[i[t+12]]+B[i[t+13]]+B[i[t+14]]+B[i[t+15]]}const le=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Vt={randomUUID:le};function Yt(i,t,e){if(Vt.randomUUID&&!i)return Vt.randomUUID();i=i||{};const s=i.random||(i.rng||fe)();return s[6]=s[6]&15|64,s[8]=s[8]&63|128,he(s)}class _e extends de.EventEmitter{constructor(t,e){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=s=>{const o=s.data;if(s.origin===this.targetOrigin&&ue(o)){if(o.id==="OBR_READY"){this.ready=!0;const n=o.data;this.ref=n.ref,this.userId=n.userId}this.emit(o.id,o.data)}},this.send=(s,o,n)=>{var u;if(!this.ref)throw Error("Unable to send message: not ready");(u=window.parent)===null||u===void 0||u.postMessage({id:s,data:o,ref:this.ref,nonce:n},this.targetOrigin)},this.sendAsync=(s,o,n=5e3)=>{const u=`_${Yt()}`;return this.send(s,o,u),Promise.race([new Promise((h,f)=>{const a=this;function r(T){a.off(`${s}_RESPONSE${u}`,r),a.off(`${s}_ERROR${u}`,c),h(T)}function c(T){a.off(`${s}_RESPONSE${u}`,r),a.off(`${s}_ERROR${u}`,c),f(T)}this.on(`${s}_RESPONSE${u}`,r),this.on(`${s}_ERROR${u}`,c)}),...n>0?[new Promise((h,f)=>window.setTimeout(()=>f(new Error(`Message ${s} took longer than ${n}ms to get a result`)),n))]:[]])},this.roomId=e,this.targetOrigin=t,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var kt=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class Ee{constructor(t){this.messageBus=t}show(t,e){return kt(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:t,variant:e});return s})}close(t){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:t})})}}var K=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class ye{constructor(t){this.messageBus=t}getColor(){return K(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return t})}setColor(t){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:t})})}getStrokeWidth(){return K(this,void 0,void 0,function*(){const{strokeWidth:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return t})}setStrokeWidth(t){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:t})})}getFilled(){return K(this,void 0,void 0,function*(){const{filled:t}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return t})}setFilled(t){return K(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:t})})}onChange(t){const e=s=>{t(s.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",e)}}}var x=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class Oe{constructor(t){this.messageBus=t}getDpi(){return x(this,void 0,void 0,function*(){const{dpi:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return t})}getScale(){return x(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(t){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:t})})}getColor(){return x(this,void 0,void 0,function*(){const{color:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return t})}setColor(t){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:t})})}getOpacity(){return x(this,void 0,void 0,function*(){const{opacity:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return t})}setOpacity(t){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:t})})}getType(){return x(this,void 0,void 0,function*(){const{type:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return t})}setType(t){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:t})})}getLineType(){return x(this,void 0,void 0,function*(){const{lineType:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return t})}setLineType(t){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:t})})}getMeasurement(){return x(this,void 0,void 0,function*(){const{measurement:t}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return t})}setMeasurement(t){return x(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:t})})}snapPosition(t,e,s,o){return x(this,void 0,void 0,function*(){const{position:n}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:t,snappingSensitivity:e,useCorners:s,useCenter:o});return n})}getDistance(t,e){return x(this,void 0,void 0,function*(){const{distance:s}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:t,to:e});return s})}onChange(t){const e=s=>{t(s.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",e)}}}var ot=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class pe{constructor(t){this.messageBus=t}undo(){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return ot(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return ot(this,void 0,void 0,function*(){const{canUndo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return t})}canRedo(){return ot(this,void 0,void 0,function*(){const{canRedo:t}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return t})}}function I(i){for(var t=arguments.length,e=Array(t>1?t-1:0),s=1;s<t;s++)e[s-1]=arguments[s];throw Error("[Immer] minified error nr: "+i+(e.length?" "+e.map(function(o){return"'"+o+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function $(i){return!!i&&!!i[b]}function k(i){var t;return!!i&&(function(e){if(!e||typeof e!="object")return!1;var s=Object.getPrototypeOf(e);if(s===null)return!0;var o=Object.hasOwnProperty.call(s,"constructor")&&s.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===Ie}(i)||Array.isArray(i)||!!i[X]||!!(!((t=i.constructor)===null||t===void 0)&&t[X])||ht(i)||lt(i))}function J(i,t,e){e===void 0&&(e=!1),H(i)===0?(e?Object.keys:Mt)(i).forEach(function(s){e&&typeof s=="symbol"||t(s,i[s],i)}):i.forEach(function(s,o){return t(o,s,i)})}function H(i){var t=i[b];return t?t.i>3?t.i-4:t.i:Array.isArray(i)?1:ht(i)?2:lt(i)?3:0}function et(i,t){return H(i)===2?i.has(t):Object.prototype.hasOwnProperty.call(i,t)}function at(i,t){return H(i)===2?i.get(t):i[t]}function Xt(i,t,e){var s=H(i);s===2?i.set(t,e):s===3?i.add(e):i[t]=e}function me(i,t){return i===t?i!==0||1/i==1/t:i!=i&&t!=t}function ht(i){return Re&&i instanceof Map}function lt(i){return Be&&i instanceof Set}function j(i){return i.o||i.t}function It(i){if(Array.isArray(i))return Array.prototype.slice.call(i);var t=Ne(i);delete t[b];for(var e=Mt(t),s=0;s<e.length;s++){var o=e[s],n=t[o];n.writable===!1&&(n.writable=!0,n.configurable=!0),(n.get||n.set)&&(t[o]={configurable:!0,writable:!0,enumerable:n.enumerable,value:i[o]})}return Object.create(Object.getPrototypeOf(i),t)}function Nt(i,t){return t===void 0&&(t=!1),Ct(i)||$(i)||!k(i)||(H(i)>1&&(i.set=i.add=i.clear=i.delete=Te),Object.freeze(i),t&&J(i,function(e,s){return Nt(s,!0)},!0)),i}function Te(){I(2)}function Ct(i){return i==null||typeof i!="object"||Object.isFrozen(i)}function U(i){var t=At[i];return t||I(18,i),t}function ge(i,t){At[i]||(At[i]=t)}function Ht(){return nt}function _t(i,t){t&&(U("Patches"),i.u=[],i.s=[],i.v=t)}function dt(i){Tt(i),i.p.forEach(ve),i.p=null}function Tt(i){i===nt&&(nt=i.l)}function jt(i){return nt={p:[],l:nt,h:i,m:!0,_:0}}function ve(i){var t=i[b];t.i===0||t.i===1?t.j():t.g=!0}function Et(i,t){t._=t.p.length;var e=t.p[0],s=i!==void 0&&i!==e;return t.h.O||U("ES5").S(t,i,s),s?(e[b].P&&(dt(t),I(4)),k(i)&&(i=ct(t,i),t.l||ft(t,i)),t.u&&U("Patches").M(e[b].t,i,t.u,t.s)):i=ct(t,e,[]),dt(t),t.u&&t.v(t.u,t.s),i!==xt?i:void 0}function ct(i,t,e){if(Ct(t))return t;var s=t[b];if(!s)return J(t,function(h,f){return Wt(i,s,t,h,f,e)},!0),t;if(s.A!==i)return t;if(!s.P)return ft(i,s.t,!0),s.t;if(!s.I){s.I=!0,s.A._--;var o=s.i===4||s.i===5?s.o=It(s.k):s.o,n=o,u=!1;s.i===3&&(n=new Set(o),o.clear(),u=!0),J(n,function(h,f){return Wt(i,s,o,h,f,e,u)}),ft(i,o,!1),e&&i.u&&U("Patches").N(s,e,i.u,i.s)}return s.o}function Wt(i,t,e,s,o,n,u){if($(o)){var h=ct(i,o,n&&t&&t.i!==3&&!et(t.R,s)?n.concat(s):void 0);if(Xt(e,s,h),!$(h))return;i.m=!1}else u&&e.add(o);if(k(o)&&!Ct(o)){if(!i.h.D&&i._<1)return;ct(i,o),t&&t.A.l||ft(i,o)}}function ft(i,t,e){e===void 0&&(e=!1),!i.l&&i.h.D&&i.m&&Nt(t,e)}function yt(i,t){var e=i[b];return(e?j(e):i)[t]}function Ft(i,t){if(t in i)for(var e=Object.getPrototypeOf(i);e;){var s=Object.getOwnPropertyDescriptor(e,t);if(s)return s;e=Object.getPrototypeOf(e)}}function gt(i){i.P||(i.P=!0,i.l&&gt(i.l))}function Ot(i){i.o||(i.o=It(i.t))}function vt(i,t,e){var s=ht(t)?U("MapSet").F(t,e):lt(t)?U("MapSet").T(t,e):i.O?function(o,n){var u=Array.isArray(o),h={i:u?1:0,A:n?n.A:Ht(),P:!1,I:!1,R:{},l:n,t:o,k:null,o:null,j:null,C:!1},f=h,a=Rt;u&&(f=[h],a=Y);var r=Proxy.revocable(f,a),c=r.revoke,T=r.proxy;return h.k=T,h.j=c,T}(t,e):U("ES5").J(t,e);return(e?e.A:Ht()).p.push(s),s}function Ae(i){return $(i)||I(22,i),function t(e){if(!k(e))return e;var s,o=e[b],n=H(e);if(o){if(!o.P&&(o.i<4||!U("ES5").K(o)))return o.t;o.I=!0,s=$t(e,n),o.I=!1}else s=$t(e,n);return J(s,function(u,h){o&&at(o.t,u)===h||Xt(s,u,t(h))}),n===3?new Set(s):s}(i)}function $t(i,t){switch(t){case 2:return new Map(i);case 3:return Array.from(i)}return It(i)}function Lt(){function i(s){if(!k(s))return s;if(Array.isArray(s))return s.map(i);if(ht(s))return new Map(Array.from(s.entries()).map(function(u){return[u[0],i(u[1])]}));if(lt(s))return new Set(Array.from(s).map(i));var o=Object.create(Object.getPrototypeOf(s));for(var n in s)o[n]=i(s[n]);return et(s,X)&&(o[X]=s[X]),o}function t(s){return $(s)?i(s):s}var e="add";ge("Patches",{$:function(s,o){return o.forEach(function(n){for(var u=n.path,h=n.op,f=s,a=0;a<u.length-1;a++){var r=H(f),c=u[a];typeof c!="string"&&typeof c!="number"&&(c=""+c),r!==0&&r!==1||c!=="__proto__"&&c!=="constructor"||I(24),typeof f=="function"&&c==="prototype"&&I(24),typeof(f=at(f,c))!="object"&&I(15,u.join("/"))}var T=H(f),p=i(n.value),g=u[u.length-1];switch(h){case"replace":switch(T){case 2:return f.set(g,p);case 3:I(16);default:return f[g]=p}case e:switch(T){case 1:return g==="-"?f.push(p):f.splice(g,0,p);case 2:return f.set(g,p);case 3:return f.add(p);default:return f[g]=p}case"remove":switch(T){case 1:return f.splice(g,1);case 2:return f.delete(g);case 3:return f.delete(n.value);default:return delete f[g]}default:I(17,h)}}),s},N:function(s,o,n,u){switch(s.i){case 0:case 4:case 2:return function(h,f,a,r){var c=h.t,T=h.o;J(h.R,function(p,g){var A=at(c,p),N=at(T,p),C=g?et(c,p)?"replace":e:"remove";if(A!==N||C!=="replace"){var L=f.concat(p);a.push(C==="remove"?{op:C,path:L}:{op:C,path:L,value:N}),r.push(C===e?{op:"remove",path:L}:C==="remove"?{op:e,path:L,value:t(A)}:{op:"replace",path:L,value:t(A)})}})}(s,o,n,u);case 5:case 1:return function(h,f,a,r){var c=h.t,T=h.R,p=h.o;if(p.length<c.length){var g=[p,c];c=g[0],p=g[1];var A=[r,a];a=A[0],r=A[1]}for(var N=0;N<c.length;N++)if(T[N]&&p[N]!==c[N]){var C=f.concat([N]);a.push({op:"replace",path:C,value:t(p[N])}),r.push({op:"replace",path:C,value:t(c[N])})}for(var L=c.length;L<p.length;L++){var V=f.concat([L]);a.push({op:e,path:V,value:t(p[L])})}c.length<p.length&&r.push({op:"replace",path:f.concat(["length"]),value:c.length})}(s,o,n,u);case 3:return function(h,f,a,r){var c=h.t,T=h.o,p=0;c.forEach(function(g){if(!T.has(g)){var A=f.concat([p]);a.push({op:"remove",path:A,value:g}),r.unshift({op:e,path:A,value:g})}p++}),p=0,T.forEach(function(g){if(!c.has(g)){var A=f.concat([p]);a.push({op:e,path:A,value:g}),r.unshift({op:"remove",path:A,value:g})}p++})}(s,o,n,u)}},M:function(s,o,n,u){n.push({op:"replace",path:[],value:o===xt?void 0:o}),u.push({op:"replace",path:[],value:s})}})}var Kt,nt,St=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Re=typeof Map<"u",Be=typeof Set<"u",zt=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",xt=St?Symbol.for("immer-nothing"):((Kt={})["immer-nothing"]=!0,Kt),X=St?Symbol.for("immer-draftable"):"__$immer_draftable",b=St?Symbol.for("immer-state"):"__$immer_state",Ie=""+Object.prototype.constructor,Mt=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(i){return Object.getOwnPropertyNames(i).concat(Object.getOwnPropertySymbols(i))}:Object.getOwnPropertyNames,Ne=Object.getOwnPropertyDescriptors||function(i){var t={};return Mt(i).forEach(function(e){t[e]=Object.getOwnPropertyDescriptor(i,e)}),t},At={},Rt={get:function(i,t){if(t===b)return i;var e=j(i);if(!et(e,t))return function(o,n,u){var h,f=Ft(n,u);return f?"value"in f?f.value:(h=f.get)===null||h===void 0?void 0:h.call(o.k):void 0}(i,e,t);var s=e[t];return i.I||!k(s)?s:s===yt(i.t,t)?(Ot(i),i.o[t]=vt(i.A.h,s,i)):s},has:function(i,t){return t in j(i)},ownKeys:function(i){return Reflect.ownKeys(j(i))},set:function(i,t,e){var s=Ft(j(i),t);if(s?.set)return s.set.call(i.k,e),!0;if(!i.P){var o=yt(j(i),t),n=o?.[b];if(n&&n.t===e)return i.o[t]=e,i.R[t]=!1,!0;if(me(e,o)&&(e!==void 0||et(i.t,t)))return!0;Ot(i),gt(i)}return i.o[t]===e&&(e!==void 0||t in i.o)||Number.isNaN(e)&&Number.isNaN(i.o[t])||(i.o[t]=e,i.R[t]=!0),!0},deleteProperty:function(i,t){return yt(i.t,t)!==void 0||t in i.t?(i.R[t]=!1,Ot(i),gt(i)):delete i.R[t],i.o&&delete i.o[t],!0},getOwnPropertyDescriptor:function(i,t){var e=j(i),s=Reflect.getOwnPropertyDescriptor(e,t);return s&&{writable:!0,configurable:i.i!==1||t!=="length",enumerable:s.enumerable,value:e[t]}},defineProperty:function(){I(11)},getPrototypeOf:function(i){return Object.getPrototypeOf(i.t)},setPrototypeOf:function(){I(12)}},Y={};J(Rt,function(i,t){Y[i]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),Y.deleteProperty=function(i,t){return Y.set.call(this,i,t,void 0)},Y.set=function(i,t,e){return Rt.set.call(this,i[0],t,e,i[0])};var Ce=function(){function i(e){var s=this;this.O=zt,this.D=!0,this.produce=function(o,n,u){if(typeof o=="function"&&typeof n!="function"){var h=n;n=o;var f=s;return function(A){var N=this;A===void 0&&(A=h);for(var C=arguments.length,L=Array(C>1?C-1:0),V=1;V<C;V++)L[V-1]=arguments[V];return f.produce(A,function(_){var l;return(l=n).call.apply(l,[N,_].concat(L))})}}var a;if(typeof n!="function"&&I(6),u!==void 0&&typeof u!="function"&&I(7),k(o)){var r=jt(s),c=vt(s,o,void 0),T=!0;try{a=n(c),T=!1}finally{T?dt(r):Tt(r)}return typeof Promise<"u"&&a instanceof Promise?a.then(function(A){return _t(r,u),Et(A,r)},function(A){throw dt(r),A}):(_t(r,u),Et(a,r))}if(!o||typeof o!="object"){if((a=n(o))===void 0&&(a=o),a===xt&&(a=void 0),s.D&&Nt(a,!0),u){var p=[],g=[];U("Patches").M(o,a,p,g),u(p,g)}return a}I(21,o)},this.produceWithPatches=function(o,n){if(typeof o=="function")return function(a){for(var r=arguments.length,c=Array(r>1?r-1:0),T=1;T<r;T++)c[T-1]=arguments[T];return s.produceWithPatches(a,function(p){return o.apply(void 0,[p].concat(c))})};var u,h,f=s.produce(o,n,function(a,r){u=a,h=r});return typeof Promise<"u"&&f instanceof Promise?f.then(function(a){return[a,u,h]}):[f,u,h]},typeof e?.useProxies=="boolean"&&this.setUseProxies(e.useProxies),typeof e?.autoFreeze=="boolean"&&this.setAutoFreeze(e.autoFreeze)}var t=i.prototype;return t.createDraft=function(e){k(e)||I(8),$(e)&&(e=Ae(e));var s=jt(this),o=vt(this,e,void 0);return o[b].C=!0,Tt(s),o},t.finishDraft=function(e,s){var o=e&&e[b],n=o.A;return _t(n,s),Et(void 0,n)},t.setAutoFreeze=function(e){this.D=e},t.setUseProxies=function(e){e&&!zt&&I(20),this.O=e},t.applyPatches=function(e,s){var o;for(o=s.length-1;o>=0;o--){var n=s[o];if(n.path.length===0&&n.op==="replace"){e=n.value;break}}o>-1&&(s=s.slice(o+1));var u=U("Patches").$;return $(e)?u(e,s):this.produce(e,function(h){return u(h,s)})},i}(),w=new Ce;w.produce;var bt=w.produceWithPatches.bind(w);w.setAutoFreeze.bind(w);w.setUseProxies.bind(w);w.applyPatches.bind(w);w.createDraft.bind(w);w.finishDraft.bind(w);var z=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};Lt();class Le{constructor(t){this.messageBus=t}getItems(t){return z(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e,s=!0){return z(this,void 0,void 0,function*(){let o;this.isItemArray(t)?o=t:o=yield this.getItems(t);const[n,u]=bt(o,e),h=n.map(a=>({id:a.id,type:a.type}));for(const a of u){const[r,c]=a.path;typeof r=="number"&&typeof c=="string"&&(h[r][c]=n[r][c])}const f=h.filter(a=>Object.keys(a).length>2);f.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:f,updateAttachments:s}))})}addItems(t){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:t})})}deleteItems(t){return z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return z(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return z(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=s=>{t(s.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",e)}}}var Z=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};Lt();class Se{constructor(t){this.messageBus=t}getItems(t){return Z(this,void 0,void 0,function*(){if(Array.isArray(t)){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:t});return e}else if(t){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e.filter(t)}else{const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return e}})}isItemArray(t){return Array.isArray(t)&&t.every(e=>typeof e!="string")}updateItems(t,e,s,o=!0){return Z(this,void 0,void 0,function*(){let n;this.isItemArray(t)?n=t:n=yield this.getItems(t);const[u,h]=bt(n,e),f=u.map(r=>({id:r.id,type:r.type}));for(const r of h){const[c,T]=r.path;typeof c=="number"&&typeof T=="string"&&(f[c][T]=u[c][T])}const a=f.filter(r=>Object.keys(r).length>2);a.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:a,fastUpdate:s,updateAttachments:o}))})}addItems(t){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:t})})}deleteItems(t){return Z(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:t})})}getItemAttachments(t){return Z(this,void 0,void 0,function*(){const{items:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:t});return e})}getItemBounds(t){return Z(this,void 0,void 0,function*(){const{bounds:e}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:t});return e})}onChange(t){const e=s=>{t(s.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",e)}}}var pt=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class xe{constructor(t){this.messageBus=t,this.grid=new Oe(t),this.fog=new ye(t),this.history=new pe(t),this.items=new Le(t),this.local=new Se(t)}isReady(){return pt(this,void 0,void 0,function*(){const{ready:t}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return t})}onReadyChange(t){const e=s=>{t(s.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",e)}}getMetadata(){return pt(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return t})}setMetadata(t){return pt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:t})})}onMetadataChange(t){const e=s=>{t(s.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",e)}}}function te(i){return i.startsWith("http")?i:`${window.location.origin}${i}`}function tt(i){return i.map(t=>Object.assign(Object.assign({},t),{icon:te(t.icon)}))}function wt(i){return Object.assign(Object.assign({},i),{url:te(i.url)})}var Zt=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class Me{constructor(t){this.contextMenus={},this.handleClick=e=>{var s;const o=this.contextMenus[e.id];o&&((s=o.onClick)===null||s===void 0||s.call(o,e.context,e.elementId))},this.messageBus=t,t.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(t){return Zt(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:t.id,shortcut:t.shortcut,icons:tt(t.icons),embed:t.embed&&wt(t.embed)}),this.contextMenus[t.id]=t})}remove(t){return Zt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:t}),delete this.contextMenus[t]})}}var G=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class be{constructor(t){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=e=>{const s=this.tools[e.id];if(s)if(s.onClick){const o=s.onClick(e.context,e.elementId);Promise.resolve(o).then(n=>{n&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:e.id})},this.handleToolActionClick=e=>{var s;const o=this.toolActions[e.id];o&&((s=o.onClick)===null||s===void 0||s.call(o,e.context,e.elementId))},this.handleToolModeClick=e=>{const s=this.toolModes[e.id];if(s)if(s.onClick){const o=s.onClick(e.context,e.elementId);Promise.resolve(o).then(n=>{n&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:e.context.activeTool,modeId:e.id})},this.handleToolModeToolClick=e=>{const s=this.toolModes[e.id];if(s)if(s.onToolClick){const o=s.onToolClick(e.context,e.event);Promise.resolve(o).then(n=>{n&&e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&!e.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDoubleClick=e=>{const s=this.toolModes[e.id];if(s)if(s.onToolDoubleClick){const o=s.onToolDoubleClick(e.context,e.event);Promise.resolve(o).then(n=>{n&&e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})})}else e.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[e.event.target.id]})},this.handleToolModeToolDown=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDown)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolMove=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolMove)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolUp=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolUp)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragStart=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragStart)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragMove=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragMove)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragEnd=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragEnd)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeToolDragCancel=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onToolDragCancel)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeKeyDown=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onKeyDown)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeKeyUp=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onKeyUp)===null||s===void 0||s.call(o,e.context,e.event))},this.handleToolModeActivate=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onActivate)===null||s===void 0||s.call(o,e.context))},this.handleToolModeDeactivate=e=>{var s;const o=this.toolModes[e.id];o&&((s=o.onDeactivate)===null||s===void 0||s.call(o,e.context))},this.messageBus=t,t.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),t.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),t.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),t.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),t.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),t.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),t.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),t.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),t.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),t.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:t.id,shortcut:t.shortcut,defaultMode:t.defaultMode,defaultMetadata:t.defaultMetadata,icons:tt(t.icons),disabled:t.disabled}),this.tools[t.id]=t})}remove(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:t}),delete this.tools[t]})}activateTool(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:t})})}getMetadata(t){return G(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:t});return e})}setMetadata(t,e){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:t,update:e})})}createAction(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:t.id,shortcut:t.shortcut,icons:tt(t.icons),disabled:t.disabled}),this.toolActions[t.id]=t})}removeAction(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:t}),delete this.tools[t]})}createMode(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:t.id,shortcut:t.shortcut,icons:tt(t.icons),preventDrag:t.preventDrag,disabled:t.disabled,cursors:t.cursors}),this.toolModes[t.id]=t})}removeMode(t){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:t}),delete this.tools[t]})}activateMode(t,e){return G(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:t,modeId:e})})}}var q=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class we{constructor(t){this.messageBus=t}open(t){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},wt(t)))})}close(t){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:t})})}getWidth(t){return q(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:t});return e})}setWidth(t,e){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:t,width:e})})}getHeight(t){return q(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:t});return e})}setHeight(t,e){return q(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:t,height:e})})}}var qt=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class De{constructor(t){this.messageBus=t}open(t){return qt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},wt(t)))})}close(t){return qt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:t})})}}var M=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class Pe{constructor(t){this.messageBus=t}getWidth(){return M(this,void 0,void 0,function*(){const{width:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return t})}setWidth(t){return M(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:t})})}getHeight(){return M(this,void 0,void 0,function*(){const{height:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return t})}setHeight(t){return M(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:t})})}getBadgeText(){return M(this,void 0,void 0,function*(){const{badgeText:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return t})}setBadgeText(t){return M(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:t})})}getBadgeBackgroundColor(){return M(this,void 0,void 0,function*(){const{badgeBackgroundColor:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return t})}setBadgeBackgroundColor(t){return M(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:t})})}getIcon(){return M(this,void 0,void 0,function*(){const{icon:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return t})}setIcon(t){return M(this,void 0,void 0,function*(){const e=tt([{icon:t}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:e[0].icon})})}getTitle(){return M(this,void 0,void 0,function*(){const{title:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return t})}setTitle(t){return M(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:t})})}isOpen(){return M(this,void 0,void 0,function*(){const{isOpen:t}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return t})}open(){return M(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return M(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(t){const e=s=>{t(s.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",e)}}}var Ge=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};Lt();class Ue{constructor(t){this.messageBus=t}startItemInteraction(t,e=!0){return Ge(this,void 0,void 0,function*(){const{id:s}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:t,updateAttachments:e});let o=t;return[h=>{const[f,a]=bt(o,h);return o=f,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:s,patches:a}),f},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:s})}]})}}var Ve=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class ke{constructor(t){this.messageBus=t}getPlayers(){return Ve(this,void 0,void 0,function*(){const{players:t}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return t})}onChange(t){const e=s=>{t(s.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",e)}}}var mt=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class He{constructor(t){this.messageBus=t}get id(){return this.messageBus.roomId}getPermissions(){return mt(this,void 0,void 0,function*(){const{permissions:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return t})}getMetadata(){return mt(this,void 0,void 0,function*(){const{metadata:t}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return t})}setMetadata(t){return mt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:t})})}onMetadataChange(t){const e=s=>{t(s.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",e)}}onPermissionsChange(t){const e=s=>{t(s.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",e)}}}var je=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class We{constructor(t){this.messageBus=t}getTheme(){return je(this,void 0,void 0,function*(){const{theme:t}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return t})}onChange(t){const e=s=>{t(s.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",e),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",e)}}}var rt=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class Fe{constructor(t){this.messageBus=t}uploadImages(t,e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:t,typeHint:e})})}uploadScenes(t,e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:t,disableShowScenes:e})})}downloadImages(t,e,s){return rt(this,void 0,void 0,function*(){const{images:o}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:t,defaultSearch:e,typeHint:s},-1);return o})}downloadScenes(t,e){return rt(this,void 0,void 0,function*(){const{scenes:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:t,defaultSearch:e},-1);return s})}}var $e=function(i,t,e,s){function o(n){return n instanceof e?n:new e(function(u){u(n)})}return new(e||(e=Promise))(function(n,u){function h(r){try{a(s.next(r))}catch(c){u(c)}}function f(r){try{a(s.throw(r))}catch(c){u(c)}}function a(r){r.done?n(r.value):o(r.value).then(h,f)}a((s=s.apply(i,t||[])).next())})};class Ke{constructor(t){this.messageBus=t}sendMessage(t,e,s){return $e(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:t,data:e,options:s})})}onMessage(t,e){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:t}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${t}`,e),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:t}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${t}`,e)}}}class ee{constructor(t){this._item={createdUserId:t.id,id:Yt(),name:"Item",zIndex:Date.now(),lastModified:new Date().toISOString(),lastModifiedUserId:t.id,locked:!1,metadata:{},position:{x:0,y:0},rotation:0,scale:{x:1,y:1},type:"ITEM",visible:!0,layer:"POPOVER"}}createdUserId(t){return this._item.createdUserId=t,this.self()}id(t){return this._item.id=t,this.self()}name(t){return this._item.name=t,this.self()}description(t){return this._item.description=t,this.self()}lastModified(t){return this._item.lastModified=t,this.self()}zIndex(t){return this._item.zIndex=t,this.self()}lastModifiedUserId(t){return this._item.lastModifiedUserId=t,this.self()}locked(t){return this._item.locked=t,this.self()}metadata(t){return this._item.metadata=t,this.self()}position(t){return this._item.position=t,this.self()}rotation(t){return this._item.rotation=t,this.self()}scale(t){return this._item.scale=t,this.self()}visible(t){return this._item.visible=t,this.self()}attachedTo(t){return this._item.attachedTo=t,this.self()}layer(t){return this._item.layer=t,this.self()}disableHit(t){return this._item.disableHit=t,this.self()}disableAutoZIndex(t){return this._item.disableAutoZIndex=t,this.self()}disableAttachmentBehavior(t){return this._item.disableAttachmentBehavior=t,this.self()}self(){return this}}class ze extends ee{constructor(t){super(t),this._text={richText:[{type:"paragraph",children:[{text:""}]}],plainText:"",style:{padding:0,fontFamily:"Roboto",fontSize:16,fontWeight:400,textAlign:"LEFT",textAlignVertical:"TOP",fillColor:"white",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:0,lineHeight:1.5},type:"RICH",width:"AUTO",height:"AUTO"},this._item.layer="TEXT",this._item.name="Text"}text(t){return this._text=t,this.self()}width(t){return this._text.width=t,this.self()}height(t){return this._text.height=t,this.self()}richText(t){return this._text.richText=t,this.self()}plainText(t){return this._text.plainText=t,this.self()}textType(t){return this._text.type=t,this.self()}padding(t){return this._text.style.padding=t,this.self()}fontFamily(t){return this._text.style.fontFamily=t,this.self()}fontSize(t){return this._text.style.fontSize=t,this.self()}fontWeight(t){return this._text.style.fontWeight=t,this.self()}textAlign(t){return this._text.style.textAlign=t,this.self()}textAlignVertical(t){return this._text.style.textAlignVertical=t,this.self()}fillColor(t){return this._text.style.fillColor=t,this.self()}fillOpacity(t){return this._text.style.fillOpacity=t,this.self()}strokeColor(t){return this._text.style.strokeColor=t,this.self()}strokeOpacity(t){return this._text.style.strokeOpacity=t,this.self()}strokeWidth(t){return this._text.style.strokeWidth=t,this.self()}lineHeight(t){return this._text.style.lineHeight=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"TEXT",text:this._text})}}class Ze extends ee{constructor(t){super(t),this._commands=[],this._fillRule="nonzero",this._style={fillColor:"black",fillOpacity:1,strokeColor:"white",strokeOpacity:1,strokeWidth:5,strokeDash:[]},this._item.name="Path",this._item.layer="DRAWING"}commands(t){return this._commands=t,this.self()}fillRule(t){return this._fillRule=t,this.self()}style(t){return this._style=t,this.self()}fillColor(t){return this._style.fillColor=t,this.self()}fillOpacity(t){return this._style.fillOpacity=t,this.self()}strokeColor(t){return this._style.strokeColor=t,this.self()}strokeOpacity(t){return this._style.strokeOpacity=t,this.self()}strokeWidth(t){return this._style.strokeWidth=t,this.self()}strokeDash(t){return this._style.strokeDash=t,this.self()}build(){return Object.assign(Object.assign({},this._item),{type:"PATH",commands:this._commands,fillRule:this._fillRule,style:this._style})}}const Dt=typeof Buffer=="function",Jt=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const qe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",Je=Array.prototype.slice.call(qe),ut=(i=>{let t={};return i.forEach((e,s)=>t[e]=s),t})(Je),Qe=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,F=String.fromCharCode.bind(String),Qt=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):i=>new Uint8Array(Array.prototype.slice.call(i,0)),ne=i=>i.replace(/[^A-Za-z0-9\+\/]/g,""),Ye=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Xe=i=>{switch(i.length){case 4:var t=(7&i.charCodeAt(0))<<18|(63&i.charCodeAt(1))<<12|(63&i.charCodeAt(2))<<6|63&i.charCodeAt(3),e=t-65536;return F((e>>>10)+55296)+F((e&1023)+56320);case 3:return F((15&i.charCodeAt(0))<<12|(63&i.charCodeAt(1))<<6|63&i.charCodeAt(2));default:return F((31&i.charCodeAt(0))<<6|63&i.charCodeAt(1))}},tn=i=>i.replace(Ye,Xe),en=i=>{if(i=i.replace(/\s+/g,""),!Qe.test(i))throw new TypeError("malformed base64.");i+="==".slice(2-(i.length&3));let t,e="",s,o;for(let n=0;n<i.length;)t=ut[i.charAt(n++)]<<18|ut[i.charAt(n++)]<<12|(s=ut[i.charAt(n++)])<<6|(o=ut[i.charAt(n++)]),e+=s===64?F(t>>16&255):o===64?F(t>>16&255,t>>8&255):F(t>>16&255,t>>8&255,t&255);return e},ie=typeof atob=="function"?i=>atob(ne(i)):Dt?i=>Buffer.from(i,"base64").toString("binary"):en,nn=Dt?i=>Qt(Buffer.from(i,"base64")):i=>Qt(ie(i).split("").map(t=>t.charCodeAt(0))),sn=Dt?i=>Buffer.from(i,"base64").toString("utf8"):Jt?i=>Jt.decode(nn(i)):i=>tn(ie(i)),on=i=>ne(i.replace(/[-_]/g,t=>t=="-"?"+":"/")),rn=i=>sn(on(i));function un(){const t=new URLSearchParams(window.location.search).get("obrref");let e="",s="";if(t){const n=rn(t).split(" ");n.length===2&&(e=n[0],s=n[1])}return{origin:e,roomId:s}}var d;(function(i){i[i.MOVE=0]="MOVE",i[i.LINE=1]="LINE",i[i.QUAD=2]="QUAD",i[i.CONIC=3]="CONIC",i[i.CUBIC=4]="CUBIC",i[i.CLOSE=5]="CLOSE"})(d||(d={}));const Bt=un(),R=new _e(Bt.origin,Bt.roomId),an=new re(R),Pt=new oe(R),dn=new ke(R),cn=new Ee(R),fn=new xe(R),hn=new Me(R),ln=new be(R),_n=new we(R),En=new De(R),yn=new Pe(R),On=new Ue(R),pn=new He(R),mn=new We(R),Tn=new Fe(R),gn=new Ke(R),vn={onReady:i=>{R.ready?i():R.once("OBR_READY",()=>i())},get isReady(){return R.ready},viewport:an,player:Pt,party:dn,notification:cn,scene:fn,contextMenu:hn,tool:ln,popover:_n,modal:En,action:yn,interaction:On,room:pn,theme:mn,assets:Tn,broadcast:gn,isAvailable:!!Bt.origin};function An(){return new ze(Pt)}function Rn(){return new Ze(Pt)}class W{static VERSION="whatsnew-bones-134";static EXTENSIONID="com.battle-system.bones";static EXTENSIONDICEWINDOWID="com.battle-system.bones-dicewindow";static EXTENSIONDICECONTROLLERID="com.battle-system.bones-dicecontroller";static EXTENSIONNOTIFY="com.battle-system.bones-notify";static DISCORDID="com.battle-system.discord";static DICETOKENBROADCAST="bones.dicetoken.broadcast";static OPEN="OPEN";static CLOSE="CLOSE";static TRUE="TRUE";static FALSE="FALSE";static DICEZOOMSETTING=`${W.EXTENSIONID}/zoom_`;static DICEMARKERSETTING=`${W.EXTENSIONID}/marker_`;static DICECOLORSETTING=`${W.EXTENSIONID}/color_`;static SECONDDICECOLORSETTING=`${W.EXTENSIONID}/scolor_`;static DICETEXTURESETTING=`${W.EXTENSIONID}/texture_`;static COLORCHANNEL=`${W.EXTENSIONID}/colorChannel`;static NORMALDICE=/^[0-9+d]+$/;static DICENOTATION=/(\d+)[dD](\d+)(.*)$/i;static DICEMODIFIER=/([+-])(\d+)/;static PARENTHESESMATCH=/\((\d*d\d+\s*([+-]\s*\d+)?)\)/g;static PLUSMATCH=/\s?(\+\d+)\s?/g;static ALPHANUMERICTEXTMATCH=/\s[\da-zA-Z]$/;static BONESENTRY=document.querySelector("#bones-main-body-app");static BONESWINDOW=document.querySelector("#bones-window-body-app");static BONESDICECONTROLLER=document.querySelector("#bones-controller-dice");static BONESNOTIFICATIONS=document.querySelector("#bones-notify-body-app");static CHECKREGISTRATION="https://vrwtdtmnbyhaehtitrlb.supabase.co/functions/v1/patreon-check";static ANONAUTH="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZS1kZW1vIiwicm9sZSI6ImFub24iLCJleHAiOjE5ODM4MTI5OTZ9.CRXP1A7WOeoJeXxjNni43kdQwgnWNReilDMblYTn_I0";static DEFAULTTEXTURES=["default","diceOfRolling","gemstone","gemstoneMarble","rock","rust","smooth","wooden","genesys"]}class Bn{static DiceRimPath(t,e,s){const o=s/2;return[[d.MOVE,t,e-o],[d.QUAD,t-o,e-o,t-o,e],[d.QUAD,t-o,e+o,t,e+o],[d.QUAD,t+o,e+o,t+o,e],[d.QUAD,t+o,e-o,t,e-o]]}static D4Path(t,e,s){const o=s/2*.8,n={top:{x:t,y:e-o},bottomRight:{x:t+o,y:e+o*.25},bottomLeft:{x:t-o,y:e+o*.25},bottom:{x:t,y:e+o}};return[[d.MOVE,n.top.x,n.top.y],[d.LINE,n.bottomLeft.x,n.bottomLeft.y],[d.LINE,n.bottom.x,n.bottom.y],[d.LINE,n.top.x,n.top.y],[d.LINE,n.bottomRight.x,n.bottomRight.y],[d.LINE,n.bottom.x,n.bottom.y]]}static D6Path(t,e,s){const o=s/2*.8,n={top:{x:t,y:e-o},bottom:{x:t,y:e+o},topRight:{x:t+o*.866,y:e-o*.5},bottomRight:{x:t+o*.866,y:e+o*.5},topLeft:{x:t-o*.866,y:e-o*.5},bottomLeft:{x:t-o*.866,y:e+o*.5}};return[[d.MOVE,n.top.x,n.top.y],[d.LINE,n.topRight.x,n.topRight.y],[d.LINE,n.bottomRight.x,n.bottomRight.y],[d.LINE,n.bottom.x,n.bottom.y],[d.LINE,t,e],[d.LINE,n.topRight.x,n.topRight.y],[d.MOVE,t,e],[d.LINE,n.topLeft.x,n.topLeft.y],[d.LINE,n.bottomLeft.x,n.bottomLeft.y],[d.LINE,n.bottom.x,n.bottom.y],[d.MOVE,n.top.x,n.top.y],[d.LINE,n.topLeft.x,n.topLeft.y]]}static D8Path(t,e,s){const o=s/2*.8,n={top:{x:t,y:e-o},left:{x:t-o,y:e},right:{x:t+o,y:e},bottom:{x:t,y:e+o}};return[[d.MOVE,n.top.x,n.top.y],[d.LINE,n.left.x,n.left.y],[d.LINE,t,e+o*.4],[d.LINE,n.top.x,n.top.y],[d.LINE,n.right.x,n.right.y],[d.LINE,t,e+o*.4],[d.LINE,n.bottom.x,n.bottom.y],[d.LINE,n.left.x,n.left.y],[d.MOVE,n.bottom.x,n.bottom.y],[d.LINE,n.right.x,n.right.y]]}static D100Path(t,e,s){const o=s/2*.8,n={top:{x:t,y:e-o},left:{x:t-o,y:e+o*.1},leftCrink:{x:t-o*.5,y:e},right:{x:t+o,y:e+o*.1},rightCrink:{x:t+o*.5,y:e},bottom:{x:t,y:e+o},center:{x:t,y:e+o*.2}},u={top:{x:t,y:e-o},left:{x:t-o,y:e-o*.1},leftCrink:{x:t-o*.5,y:e+o*.2},right:{x:t+o,y:e-o*.1},rightCrink:{x:t+o*.5,y:e+o*.2},bottom:{x:t,y:e+o},center:{x:t,y:e-o*.2}};return[[d.MOVE,n.top.x,n.top.y],[d.LINE,n.left.x,n.left.y],[d.LINE,n.leftCrink.x,n.leftCrink.y],[d.LINE,n.top.x,n.top.y],[d.LINE,n.rightCrink.x,n.rightCrink.y],[d.LINE,n.right.x,n.right.y],[d.LINE,n.top.x,n.top.y],[d.MOVE,n.bottom.x,n.bottom.y],[d.LINE,n.left.x,n.left.y],[d.LINE,n.leftCrink.x,n.leftCrink.y],[d.LINE,n.center.x,n.center.y],[d.LINE,n.bottom.x,n.bottom.y],[d.LINE,n.right.x,n.right.y],[d.LINE,n.rightCrink.x,n.rightCrink.y],[d.LINE,n.center.x,n.center.y],[d.MOVE,u.top.x,u.top.y],[d.LINE,u.left.x,u.left.y],[d.LINE,u.leftCrink.x,u.leftCrink.y],[d.LINE,u.top.x,u.top.y],[d.LINE,u.rightCrink.x,u.rightCrink.y],[d.LINE,u.right.x,u.right.y],[d.LINE,u.top.x,u.top.y],[d.MOVE,u.bottom.x,u.bottom.y],[d.LINE,u.left.x,u.left.y],[d.LINE,u.leftCrink.x,u.leftCrink.y],[d.LINE,u.center.x,u.center.y],[d.LINE,u.bottom.x,u.bottom.y],[d.LINE,u.right.x,u.right.y],[d.LINE,u.rightCrink.x,u.rightCrink.y],[d.LINE,u.center.x,u.center.y]]}static D10Path(t,e,s){const o=s/2*.8,n={top:{x:t,y:e-o},left:{x:t-o,y:e+o*.1},leftCrink:{x:t-o*.5,y:e},right:{x:t+o,y:e+o*.1},rightCrink:{x:t+o*.5,y:e},bottom:{x:t,y:e+o},center:{x:t,y:e+o*.2}};return[[d.MOVE,n.top.x,n.top.y],[d.LINE,n.left.x,n.left.y],[d.LINE,n.leftCrink.x,n.leftCrink.y],[d.LINE,n.top.x,n.top.y],[d.LINE,n.rightCrink.x,n.rightCrink.y],[d.LINE,n.right.x,n.right.y],[d.LINE,n.top.x,n.top.y],[d.MOVE,n.bottom.x,n.bottom.y],[d.LINE,n.left.x,n.left.y],[d.LINE,n.leftCrink.x,n.leftCrink.y],[d.LINE,n.center.x,n.center.y],[d.LINE,n.bottom.x,n.bottom.y],[d.LINE,n.right.x,n.right.y],[d.LINE,n.rightCrink.x,n.rightCrink.y],[d.LINE,n.center.x,n.center.y]]}static D12Path(t,e,s){const o=s/2*.8,n={topLeft:{x:t-o*.4,y:e-o},topRight:{x:t+o*.4,y:e-o},bottomLeft:{x:t-o*.4,y:e+o},bottomRight:{x:t+o*.4,y:e+o},upLeft:{x:t-o*.7,y:e-o*.8},upRight:{x:t+o*.7,y:e-o*.8},downLeft:{x:t-o*.7,y:e+o*.8},downRight:{x:t+o*.7,y:e+o*.8},midLeft:{x:t-o,y:e-o*.2},midRight:{x:t+o,y:e-o*.2},lowMidLeft:{x:t-o,y:e+o*.2},lowMidRight:{x:t+o,y:e+o*.2},center:{x:t,y:e},centerPine:{x:t,y:e-o*.7},leftPine:{x:t-o*.5,y:e+o*.25},rightPine:{x:t+o*.5,y:e+o*.25}};return[[d.MOVE,n.topLeft.x,n.topLeft.y],[d.LINE,n.topRight.x,n.topRight.y],[d.LINE,n.upRight.x,n.upRight.y],[d.LINE,n.midRight.x,n.midRight.y],[d.LINE,n.lowMidRight.x,n.lowMidRight.y],[d.LINE,n.downRight.x,n.downRight.y],[d.LINE,n.bottomRight.x,n.bottomRight.y],[d.LINE,n.bottomLeft.x,n.bottomLeft.y],[d.LINE,n.downLeft.x,n.downLeft.y],[d.LINE,n.lowMidLeft.x,n.lowMidLeft.y],[d.LINE,n.midLeft.x,n.midLeft.y],[d.LINE,n.upLeft.x,n.upLeft.y],[d.LINE,n.topLeft.x,n.topLeft.y],[d.MOVE,n.upLeft.x,n.upLeft.y],[d.LINE,n.centerPine.x,n.centerPine.y],[d.LINE,n.center.x,n.center.y],[d.LINE,n.leftPine.x,n.leftPine.y],[d.LINE,n.midLeft.x,n.midLeft.y],[d.MOVE,n.upRight.x,n.upRight.y],[d.LINE,n.centerPine.x,n.centerPine.y],[d.MOVE,n.center.x,n.center.y],[d.LINE,n.rightPine.x,n.rightPine.y],[d.LINE,n.midRight.x,n.midRight.y],[d.MOVE,n.rightPine.x,n.rightPine.y],[d.LINE,n.bottomRight.x,n.bottomRight.y],[d.MOVE,n.leftPine.x,n.leftPine.y],[d.LINE,n.bottomLeft.x,n.bottomLeft.y]]}static D20Path(t,e,s){const o=s/2*.8,n={top:{x:t,y:e-o},bottom:{x:t,y:e+o},topRight:{x:t+o*.866,y:e-o*.5},bottomRight:{x:t+o*.866,y:e+o*.5},topLeft:{x:t-o*.866,y:e-o*.5},bottomLeft:{x:t-o*.866,y:e+o*.5},topLeftTriangle:{x:t-o*.55,y:e-o*.35},topRightTriangle:{x:t+o*.55,y:e-o*.35},bottomMidTriangle:{x:t,y:e+o*.7}};return[[d.MOVE,n.top.x,n.top.y],[d.LINE,n.topRight.x,n.topRight.y],[d.LINE,n.bottomRight.x,n.bottomRight.y],[d.LINE,n.bottom.x,n.bottom.y],[d.LINE,n.bottomLeft.x,n.bottomLeft.y],[d.LINE,n.topLeft.x,n.topLeft.y],[d.CLOSE],[d.MOVE,n.top.x,n.top.y],[d.LINE,n.topLeftTriangle.x,n.topLeftTriangle.y],[d.LINE,n.bottomLeft.x,n.bottomLeft.y],[d.LINE,n.bottomMidTriangle.x,n.bottomMidTriangle.y],[d.LINE,n.bottomRight.x,n.bottomRight.y],[d.LINE,n.topRightTriangle.x,n.topRightTriangle.y],[d.CLOSE],[d.MOVE,n.topLeft.x,n.topLeft.y],[d.LINE,n.topLeftTriangle.x,n.topLeftTriangle.y],[d.LINE,n.topRightTriangle.x,n.topRightTriangle.y],[d.LINE,n.topRight.x,n.topRight.y],[d.LINE,n.topRightTriangle.x,n.topRightTriangle.y],[d.LINE,n.bottomMidTriangle.x,n.bottomMidTriangle.y],[d.LINE,n.bottom.x,n.bottom.y],[d.LINE,n.bottomMidTriangle.x,n.bottomMidTriangle.y],[d.LINE,n.topLeftTriangle.x,n.topLeftTriangle.y],[d.CLOSE]]}}export{W as C,Bn as D,vn as O,An as a,Rn as b};
